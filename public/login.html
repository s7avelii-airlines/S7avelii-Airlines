<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Вход / Регистрация</title>
  <!-- Иконка сайта (favicon) -->
  <link rel="icon" href="images/favicon.png" type="image/favicon.png">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f6fa;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .container {
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      width: 320px;
      text-align: center;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background: #b1dc08;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover { background: #aada0b; }
    .switch {
      margin-top: 10px;
      color: #2196f3;
      cursor: pointer;
    }
    .hidden { display: none; }
    .error { color: red; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h2 id="formTitle">Вход</h2>

    <!-- Форма входа -->
    <form id="loginForm">
      <input type="text" id="loginFio" placeholder="Введите ФИО" required>
      <input type="tel" id="loginPhone" placeholder="Введите телефон" required>
      <button type="submit">Войти</button>
      <p class="error" id="loginError"></p>
    </form>

    <!-- Форма регистрации -->
    <form id="registerForm" class="hidden">
      <input type="text" id="regFio" placeholder="Введите ФИО" required>
      <input type="tel" id="regPhone" placeholder="Введите телефон" required>
      <input type="email" id="regEmail" placeholder="Введите Email" required>
      <button type="submit">Зарегистрироваться</button>
      <p class="error" id="regError"></p>
    </form>

    <!-- Переключение -->
    <p class="switch" id="switchText">Нет аккаунта? Зарегистрироваться</p>
  </div>

  <script>
    const API_URL = "http://127.0.0.1:5000";

    const loginForm = document.getElementById("loginForm");
    const registerForm = document.getElementById("registerForm");
    const switchText = document.getElementById("switchText");
    const formTitle = document.getElementById("formTitle");

    // Переключение форм
    switchText.addEventListener("click", () => {
      loginForm.classList.toggle("hidden");
      registerForm.classList.toggle("hidden");

      if(loginForm.classList.contains("hidden")) {
        formTitle.innerText = "Регистрация";
        switchText.innerText = "Уже есть аккаунт? Войти";
      } else {
        formTitle.innerText = "Вход";
        switchText.innerText = "Нет аккаунта? Зарегистрироваться";
      }
    });

    // Обработка входа
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const fio = document.getElementById("loginFio").value;
      const phone = document.getElementById("loginPhone").value;

      try {
        const res = await fetch(`${API_URL}/api/login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ fio, phone }),
          credentials: "include" // важно!
        });
        const data = await res.json();
        if(res.ok && data.ok) {
          alert("Добро пожаловать, " + fio + "!");
          window.location.href = "cabinet.html";
        } else {
          document.getElementById("loginError").innerText = data.error || "Ошибка входа";
        }
      } catch (err) {
        document.getElementById("loginError").innerText = "Ошибка соединения с сервером";
      }
    });

    // Обработка регистрации
    registerForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const fio = document.getElementById("regFio").value;
      const phone = document.getElementById("regPhone").value;
      const email = document.getElementById("regEmail").value;

      try {
        const res = await fetch(`${API_URL}/api/register`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ fio, phone, email }),
          credentials: "include" // важно!
        });
        const data = await res.json();
        if(res.ok && data.ok) {
          alert("Регистрация успешна! Теперь войдите.");
          switchText.click(); // переключаем на форму входа
        } else {
          document.getElementById("regError").innerText = data.error || "Ошибка регистрации";
        }
      } catch (err) {
        document.getElementById("regError").innerText = "Ошибка соединения с сервером";
      }
    });
  </script>
</body>
</html>
