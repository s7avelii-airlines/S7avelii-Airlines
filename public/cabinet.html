<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Кабинет — S7avelii</title>
<link rel="icon" href="images/favicon.png" type="image/png" />
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root {
  --bg: #f5f7fa;
  --card: #ffffff;
  --accent: #9cc42f;
  --muted: #8b97a6;
  --radius: 14px;
  --container: 1180px;
}
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
  background: var(--bg);
  color: #1f2937;
}
.page { max-width: var(--container); margin: 28px auto; padding: 0 20px; }

/* Header */
.full-header {
  width: 100%;
  background: var(--card);
  display: flex;
  align-items: center;
  gap: 24px;
  padding: 28px 36px;
  border-radius: 12px;
  box-shadow: 0 6px 20px rgba(16,24,40,0.06);
  flex-wrap: wrap;
}
.avatar-wrap { display: flex; align-items: center; gap: 18px; flex-wrap: wrap; }
.avatar {
  width: 118px; height: 118px; border-radius: 999px; object-fit: cover;
  border: 4px solid #fff; box-shadow: 0 6px 18px rgba(16,24,40,0.06); cursor: pointer;
}
.user-info h1 { margin: 0; font-size: 26px; display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
.user-info h1 .edit-icon { font-size: 14px; background: #eef9d6; border-radius: 999px; padding: 6px 8px; cursor: pointer; color: #1f3a07; }
.sub { color: var(--muted); margin-top: 6px; }

/* Stats */
.stats { margin-left: auto; display: flex; gap: 18px; align-items: center; flex-wrap: wrap; }
.stat { background: linear-gradient(180deg,#fff,#fcfff0); padding: 14px 18px; border-radius: 12px; min-width: 110px; text-align: center; border: 1px solid rgba(0,0,0,0.04); }
.stat .num { font-weight: 700; font-size: 20px; color: #111827; }
.stat .label { font-size: 12px; color: var(--muted); margin-top: 6px; }

/* Tabs */
.tabs { display: flex; gap: 14px; margin-top: 18px; padding: 12px 0; border-bottom: 1px solid rgba(0,0,0,0.04); overflow-x: auto; }
.tabs a { padding: 10px 14px; text-decoration: none; color: #495057; border-radius: 8px; white-space: nowrap; }
.tabs a.active { color: var(--accent); background: rgba(156,196,47,0.06); }

/* Main layout */
.grid { display: grid; grid-template-columns: 1fr 380px; gap: 22px; margin-top: 18px; }
.card { background: var(--card); border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(16,24,40,0.04); border: 1px solid rgba(0,0,0,0.03); }
.card h3 { margin: 0 0 12px 0; font-size: 18px; }
.field { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-top: 1px solid rgba(0,0,0,0.03); }
.field:first-of-type { border-top: 0; }
.label { color: var(--muted); font-size: 14px; }
.value { font-size: 15px; max-width: 60%; word-wrap: break-word; }
.edit-btn { background: transparent; border: none; color: var(--accent); cursor: pointer; font-weight: 600; }
.small-muted { color: var(--muted); font-size: 13px; margin-top: 8px; }

/* Preferences */
.pref { margin-top: 20px; padding-top: 18px; border-top: 1px solid rgba(0,0,0,0.03); }

/* Buttons and inputs */
.btn { display: inline-block; background: var(--accent); color: white; padding: 9px 14px; border-radius: 10px; border: none; cursor: pointer; }
input[type="text"], input[type="email"], input[type="tel"], select { width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #e6edf3; }

.row { display: flex; gap: 12px; flex-wrap: wrap; }
.row .col { flex: 1; }

/* Responsive */
@media (max-width: 980px) {
  .grid { grid-template-columns: 1fr; }
  .stats { margin-left: 0; margin-top: 16px; flex-wrap: wrap; }
  .full-header { flex-direction: column; align-items: flex-start; gap: 16px; }
}
@media (max-width: 600px) {
  .tabs { padding: 12px; gap: 8px; }
  .tabs a { padding: 8px 10px; font-size: 14px; }
}
</style>
</head>
<body>

<div class="page">
  <!-- Header -->
  <div class="full-header">
    <div class="avatar-wrap">
      <label for="avatarInput" title="Нажмите, чтобы поменять аватар">
        <img id="avatar" class="avatar" src="https://via.placeholder.com/150" alt="avatar">
      </label>
      <input id="avatarInput" type="file" accept="image/*" style="display:none">
      <div class="user-info">
        <h1 id="fioHeader">Загрузка... 
          <span class="edit-icon" id="editNameBtn" title="Изменить">✏</span>
        </h1>
        <div class="sub" id="phoneHeader">—</div>

        <!-- Новое: маленькая и большая картинки карты -->
        <img id="cardIcon" src="" alt="Карта" style="height:30px; margin-left:10px; cursor:pointer; display:none;">
        <img id="cardImageBig" src="" alt="Карта" style="position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); max-width:80%; max-height:80%; display:none; border:2px solid #000; background:#fff; z-index:9999;">
      </div>
    </div>

    <div class="stats" aria-hidden="false">
      <div class="stat">
        <div class="num" id="bonusMiles">—</div>
        <div class="label">бонусные мили</div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs" role="tablist">
    <a href="#" class="active" data-tab="profileTab" onclick="showTab(event)">Профиль</a>
    <a href="#" data-tab="milesTab" onclick="showTab(event)">Мои мили</a>
    <a href="#" data-tab="shopTab" onclick="showTab(event)">S7avelii Shop</a>
    <a href="#" data-tab="settingsTab" onclick="showTab(event)">Настройки</a>
  </div>

  <!-- Main grid -->
  <div class="grid">
    <!-- Левый столбец -->
    <div>
      <div id="profileTab" class="card">
        <h3>Персональные данные</h3>
        <div class="field"><div><div class="label">ФИО</div><div class="value" id="fioField">—</div></div><button class="edit-btn" onclick="enableEdit('fio')">Изменить</button></div>
        <div class="field"><div><div class="label">Дата рождения</div><div class="value" id="dobField">—</div></div><button class="edit-btn" onclick="enableEdit('dob')">Изменить</button></div>
        <div class="field"><div><div class="label">Пол</div><div class="value" id="genderField">—</div></div><button class="edit-btn" onclick="enableEdit('gender')">Изменить</button></div>
        <h3 style="margin-top:18px">Контакты</h3>
        <div class="field"><div><div class="label">Email</div><div class="value" id="emailField">—</div></div><button class="edit-btn" onclick="enableEdit('email')">Изменить</button></div>
        <div class="field"><div><div class="label">Телефон</div><div class="value" id="phoneField">—</div></div><button class="edit-btn" onclick="enableEdit('phone')">Изменить</button></div>
        <div class="field"><div><div class="label">Номер карты S7avelii Priority</div><div class="value" id="cardField">—</div></div><button class="edit-btn" onclick="enableEdit('cardNumber')">Изменить</button></div>

        <div class="pref">
          <div class="small-muted">Способы связи</div>
          <div style="margin-top:10px;display:flex;gap:12px;align-items:center;flex-wrap:wrap">
            <label><input type="checkbox" id="optSms"> мобильный телефон (SMS)</label>
            <label><input type="checkbox" id="optEmail"> e-mail</label>
          </div>
          <div style="margin-top:14px">
            <label style="display:flex;gap:10px;align-items:center"><input type="checkbox" id="optAgree"> <span class="small-muted">Согласен с условиями обработки персональных данных</span></label>
          </div>
        </div>

        <div style="margin-top:18px;display:flex;gap:12px;align-items:center;flex-wrap:wrap">
          <button class="btn" id="saveProfileBtn">Сохранить</button>
          <div id="saveInfo" class="small-muted"></div>
        </div>
      </div>

      <!-- Остальные карточки, табы, настройки — как было в старом коде -->
      <!-- … оставляем без изменений … -->

    </div>

    <!-- Правый столбец -->
    <div>
      <div class="card">
        <h3>Краткая информация</h3>
        <div style="margin-top:12px" class="small-muted">Здесь отображаются основные данные и быстрые действия.</div>
        <div style="margin-top:18px;display:flex;flex-direction:column;gap:12px">
          <button onclick="goTo('profileTab')" class="edit-btn">Редактировать профиль</button>
          <button onclick="goTo('milesTab')" class="edit-btn">Посмотреть мили</button>
          <button onclick="logout()" class="edit-btn">Выйти</button>
        </div>
      </div>

      <div class="card" style="margin-top:16px">
        <h3>Подсказка</h3>
        <div class="small-muted" style="margin-top:8px">Изменённые данные сохраняются в личном профиле. Если у вас есть сервер — данные будут отправлены на /api/profile.</div>
      </div>
    </div>
  </div>
</div>

<script>
// ===== Утилиты =====
function el(id){return document.getElementById(id);}
function showMsg(msg, time=2500){ const s=el('saveInfo'); s.innerText=msg; setTimeout(()=>s.innerText='', time); }

// ===== Tabs =====
function showTab(evt){
  evt && evt.preventDefault();
  const tabId = evt ? evt.currentTarget.getAttribute('data-tab') : 'profileTab';
  document.querySelectorAll('.tabs a').forEach(a=>a.classList.remove('active'));
  if(evt) evt.currentTarget.classList.add('active');
  ['profileTab','milesTab','shopTab','settingsTab'].forEach(id=>{
    const elc = el(id);
    if(elc) elc.style.display = (id===tabId ? 'block' : 'none');
  });
}

// ===== Load Profile =====
function loadProfile(){
  const profile = {
    fio: localStorage.getItem('fio')||'',
    phone: localStorage.getItem('phone')||'',
    email: localStorage.getItem('email')||'',
    cardNumber: localStorage.getItem('cardNumber')||'',
    cardType: localStorage.getItem('cardType')||'', // тип карты
    dob: localStorage.getItem('dob')||'',
    gender: localStorage.getItem('gender')||'',
    avatar: localStorage.getItem('avatar')||'',
    bonusMiles: localStorage.getItem('bonusMiles')||'952'
  };
  applyProfile(profile);
}

function applyProfile(p){
  el('fioField').innerText = p.fio||'—';
  el('dobField').innerText = p.dob||'—';
  el('genderField').innerText = p.gender||'—';
  el('emailField').innerText = p.email||'—';
  el('phoneField').innerText = p.phone||'—';
  el('cardField').innerText = p.cardNumber||'—';
  el('fioHeader').innerText = p.fio||'Пользователь';
  el('phoneHeader').innerText = p.phone||'';
  el('bonusMiles').innerText = p.bonusMiles||'—';
  if(p.avatar) el('avatar').src = p.avatar;

  // Новое: карта рядом с ФИО
  const cardIcon = el('cardIcon');
  if(p.cardType === 'VIP'){
    cardIcon.src = 'images/vip-card.png';
    cardIcon.style.display = 'inline-block';
  } else if(p.cardType === 'Classic'){
    cardIcon.src = 'images/classic-card.png';
    cardIcon.style.display = 'inline-block';
  } else {
    cardIcon.style.display = 'none';
  }
}

// Разворачивание карты
el('cardIcon').addEventListener('click', function(){
  const big = el('cardImageBig');
  if(big.style.display==='block'){
    big.style.display='none';
  } else {
    big.src = this.src;
    big.style.display='block';
  }
});

// ===== Inline edit =====
function enableEdit(field){
  const fieldMap = { fio:['fioField','fioHeader'], dob:['dobField'], gender:['genderField'], email:['emailField'], phone:['phoneField','phoneHeader'], cardNumber:['cardField'] };
  const ids = fieldMap[field]; if(!ids) return;
  const current = el(ids[0]).innerText==='—'?'':el(ids[0]).innerText;
  const input = document.createElement('input');
  input.type = (field==='email')?'email':(field==='phone')?'tel':'text';
  input.value = current; input.style.width='220px';
  const ok = document.createElement('button'); ok.innerText='OK'; ok.className='btn'; ok.style.marginLeft='8px'; ok.onclick=saveInline;
  const wrapper = document.createElement('div'); wrapper.appendChild(input); wrapper.appendChild(ok);
  const container = el(ids[0]); const old = container.innerHTML; container.innerHTML=''; container.appendChild(wrapper); input.focus();
  function saveInline(){
    const val = input.value.trim()||'—';
    ids.forEach(id=>{ if(el(id)) el(id).innerText=(val==='—'?'—':val); });
    if(field==='fio' && el('fioHeader')) el('fioHeader').innerText=val==='—'?'Пользователь':val;
    const storageKey = field==='cardNumber'?'cardNumber':field;
    localStorage.setItem(storageKey,val==='—'?'':val);
    tryPush({ [storageKey]: val==='—'?'':val });
    showMsg('Изменено');
  }
}

// ===== Avatar upload =====
el('avatarInput').addEventListener('change', function(){
  const f = this.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = function(e){
    const dataUrl = e.target.result;
    el('avatar').src = dataUrl;
    localStorage.setItem('avatar', dataUrl);
    showMsg('Аватар обновлён');
  };
  r.readAsDataURL(f);
});

// ===== Save full profile =====
el('saveProfileBtn').addEventListener('click', ()=>{
  const payload = {
    fio: (el('fioField').innerText==='—' ? '' : el('fioField').innerText),
    phone: (el('phoneField').innerText==='—' ? '' : el('phoneField').innerText),
    email: (el('emailField').innerText==='—' ? '' : el('emailField').innerText),
    cardNumber: (el('cardField').innerText==='—' ? '' : el('cardField').innerText),
    cardType: el('cardField').innerText.includes('VIP') ? 'VIP' : (el('cardField').innerText.includes('Classic') ? 'Classic' : ''),
    dob: (el('dobField').innerText==='—' ? '' : el('dobField').innerText),
    gender: (el('genderField').innerText==='—' ? '' : el('genderField').innerText),
    homeCity: el('homeCity')?el('homeCity').value:''
  };
  Object.keys(payload).forEach(k=>{
    try{ localStorage.setItem(k, (payload[k]||'')); }catch(e){}
  });
  showMsg('Данные сохранены локально');
});

function goTo(tab){
  document.querySelectorAll('.tabs a').forEach(a => a.classList.remove('active'));
  const a = [...document.querySelectorAll('.tabs a')].find(x=> x.getAttribute('data-tab')===tab);
  if(a) a.classList.add('active');
  showTab({ currentTarget: a, preventDefault: ()=>{} });
}

function logout(){
  localStorage.removeItem('session');
  window.location.href = '/';
}

// ===== Init =====
document.addEventListener('DOMContentLoaded', ()=>{
  loadProfile();
  showTab({ currentTarget: document.querySelector('.tabs a.active'), preventDefault: ()=>{} });
  el('editNameBtn').addEventListener('click', ()=> enableEdit('fio'));
});
</script>
</body>
</html>
