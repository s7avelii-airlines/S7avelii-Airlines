<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>–ö–∞–±–∏–Ω–µ—Ç ‚Äî S7avelii</title>
<link rel="icon" href="images/favicon.png" type="image/png">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { margin:0; font-family: Arial, sans-serif; background:#f5f7fa; }
  header { display:flex; align-items:center; justify-content:space-between; padding:0 16px; height:60px; border-bottom:1px solid #ccc; position:fixed; top:0; width:100%; background:#fff; z-index:1000; }
  .logo-img { height:45px; cursor:pointer; }
  nav ul { display:flex; gap:20px; margin:0; padding:0; list-style:none; }
  nav a { text-decoration:none; color:#000; font-size:14px; }
  .right-menu { display:flex; align-items:center; gap:10px; font-size:14px; }
  .hamburger { display:none; flex-direction:column; gap:4px; cursor:pointer; }
  .hamburger span { width:22px; height:2px; background:#000; }
  .bottom-nav { display:none; position:fixed; bottom:0; left:0; width:100%; background:rgba(255,255,255,0.95); border-top:1px solid #ddd; justify-content:space-around; padding:6px 0; z-index:1000; }
  .bottom-nav a { text-decoration:none; color:#666; font-size:12px; display:flex; flex-direction:column; align-items:center; }
  .bottom-nav a.active { color:#6cd100; font-weight:bold; }
  .bottom-nav svg { width:22px; height:22px; margin-bottom:3px; }
  @media (max-width:768px) { nav{display:none;} .hamburger{display:flex;} .bottom-nav{display:flex;} header{height:60px;padding:0 12px;} .logo-img{height:40px;} }
  .page{max-width:1180px;margin:80px auto;padding:0 20px}
  .full-header{width:100%;background:#fff;display:flex;align-items:center;gap:24px;padding:28px 36px;border-radius:12px;box-shadow:0 6px 20px rgba(16,24,40,0.06);flex-wrap:wrap}
  .avatar{width:118px;height:118px;border-radius:999px;object-fit:cover;border:4px solid #fff}
  .tabs{display:flex;gap:14px;margin-top:18px;padding:12px 0;border-bottom:1px solid rgba(0,0,0,0.04);overflow-x:auto}
  .tabs a{padding:10px 14px;text-decoration:none;color:#495057;border-radius:8px;cursor:pointer}
  .tabs a.active{color:#9cc42f;background:rgba(156,196,47,0.06)}
  .grid{display:grid;grid-template-columns:1fr 380px;gap:22px;margin-top:18px}
  .card{background:#fff;border-radius:12px;padding:20px;box-shadow:0 4px 12px rgba(16,24,40,0.04)}
  .field{display:flex;justify-content:space-between;padding:12px 0;border-top:1px solid rgba(0,0,0,0.03)}
  .small-muted{color:#8b97a6;font-size:13px}
  .btn{background:#9cc42f;color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
  .btn-red{background:#e66}
  .progress-bar{width:100%;height:18px;background:#eee;border-radius:10px;overflow:hidden;margin-top:6px}
  .progress-fill{height:100%;width:0%;background:#9cc42f;text-align:center;color:#fff;line-height:18px;font-size:12px;transition:width 0.5s ease}
  .cart-table{width:100%;border-collapse:collapse}
  .cart-table th,.cart-table td{padding:8px;border-bottom:1px solid #eee;text-align:left}
  .cart-empty{color:#777;padding:12px}
</style>
</head>
<body>
<header>
  <div class="logo">
    <a href="index.html"><img src="images/1757683264306.avif" alt="S7avelii" class="logo-img"></a>
  </div>
  <nav>
    <ul>
      <li><a href="bilet.html">–ö—É–ø–∏—Ç—å –±–∏–ª–µ—Ç</a></li>
      <li><a href="priority.html">S7avelii Priority</a></li>
      <li><a href="body.html">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</a></li>
    </ul>
  </nav>
  <div class="right-menu">
    <button>RUB</button>
  </div>
</header>

<div class="page">
  <div class="full-header">
    <div style="display:flex;align-items:center;gap:16px">
      <label for="avatarInput"><img id="avatar" class="avatar" src="https://via.placeholder.com/150" alt="avatar"></label>
      <input id="avatarInput" type="file" accept="image/*" style="display:none">
      <div>
        <h1 id="fioHeader">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
        <div class="small-muted" id="phoneHeader">‚Äî</div>
      </div>
    </div>
    <div style="margin-left:auto" class="small-muted">–ë–æ–Ω—É—Å–Ω—ã–µ –º–∏–ª–∏: <strong id="bonusMiles">‚Äî</strong>
      <div class="progress-bar"><div class="progress-fill" id="milesProgress">0%</div></div>
    </div>
  </div>

  <div class="tabs" role="tablist">
    <a class="active" data-tab="profileTab" onclick="showTab(event)">–ü—Ä–æ—Ñ–∏–ª—å</a>
    <a data-tab="milesTab" onclick="showTab(event)">–ú–æ–∏ –º–∏–ª–∏</a>
    <a data-tab="shopTab" onclick="showTab(event)">S7avelii Shop</a>
    <a data-tab="settingsTab" onclick="showTab(event)">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
  </div>

  <div class="grid">
    <div>
      <div id="profileTab" class="card">
        <h3>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
        <div class="field"><div><div class="small-muted">–§–ò–û</div><div id="fioField">‚Äî</div></div><button class="btn" onclick="enableEdit('fio')">–ò–∑–º–µ–Ω–∏—Ç—å</button></div>
        <div class="field"><div><div class="small-muted">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</div><div id="dobField">‚Äî</div></div><button class="btn" onclick="enableEdit('dob')">–ò–∑–º–µ–Ω–∏—Ç—å</button></div>
        <div class="field"><div><div class="small-muted">–ü–æ–ª</div><div id="genderField">‚Äî</div></div><button class="btn" onclick="enableEdit('gender')">–ò–∑–º–µ–Ω–∏—Ç—å</button></div>

        <h3 style="margin-top:16px">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
        <div class="field"><div><div class="small-muted">Email</div><div id="emailField">‚Äî</div></div><button class="btn" onclick="enableEdit('email')">–ò–∑–º–µ–Ω–∏—Ç—å</button></div>
        <div class="field"><div><div class="small-muted">–¢–µ–ª–µ—Ñ–æ–Ω</div><div id="phoneField">‚Äî</div></div><button class="btn" onclick="enableEdit('phone')">–ò–∑–º–µ–Ω–∏—Ç—å</button></div>

        <h3 style="margin-top:16px">–ö–∞—Ä—Ç–∞</h3>
        <div class="field"><div><div class="small-muted">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</div><div id="cardField">‚Äî</div></div><button class="btn" onclick="enableEdit('cardNumber')">–ò–∑–º–µ–Ω–∏—Ç—å</button></div>
        <div class="field"><div><div class="small-muted">–¢–∏–ø –∫–∞—Ä—Ç—ã</div><div id="cardTypeField">‚Äî</div></div></div>
      </div>

     <div style="max-width:600px; margin:20px auto; font-family:Arial, sans-serif; color:#333;">
  <div style="background:#fff; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); padding:20px;">
    
    <h2 style="font-size:18px; font-weight:600; margin-bottom:10px;">
      –°—Ç–∞—Ç—É—Å –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ <a href="#" style="color:#1a73e8; text-decoration:none;">S7 Priority</a>
    </h2>

    <div style="margin-bottom:20px;">
      <div style="font-size:14px; color:#666;">–í–∞—à —Å—Ç–∞—Ç—É—Å:</div>
      <div id="statusName" style="font-size:20px; font-weight:bold;">Classic</div>
    </div>

    <div style="background:#f9fafb; border-radius:10px; padding:15px; margin-bottom:20px;">
      <div style="font-size:24px; font-weight:bold; margin-bottom:5px;">
        <span id="milesValue">0</span> –±–æ–Ω—É—Å–Ω—ã–µ –º–∏–ª–∏
      </div>
    </div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
    <div style="margin-bottom:10px; font-size:14px;">
      <span id="currentMiles" style="background:#8bc34a; color:#fff; border-radius:8px; padding:2px 8px; font-weight:bold;">0 –º–∏–ª—å</span>
      <span style="margin-left:10px; color:#666;">0 –ø–æ–ª—ë—Ç–æ–≤</span>
    </div>

    <div style="background:#e9ecef; border-radius:6px; height:12px; width:100%; overflow:hidden;">
      <div id="milesProgress" style="background:#8bc34a; height:100%; width:0%;"></div>
    </div>

    <div style="display:flex; justify-content:space-between; margin-top:5px; font-size:12px; color:#999;">
      <span id="nextLevelName">Classic Master</span>
      <span id="nextLevelMiles">5000</span>
    </div>

    <div style="margin-top:15px; font-size:14px; color:#666;">
      –°—Ç–∞—Ç—É—Å–Ω—ã—Ö –º–∏–ª—å: <b id="statusMiles">0</b><br>
      –ü–æ–ª—ë—Ç–æ–≤: <b id="flights">0</b>
    </div>

    <!-- –ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏ -->
    <div style="margin-top:20px;">
      <h3 style="font-size:15px; margin-bottom:10px; color:#444;">–ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏ —Å—Ç–∞—Ç—É—Å–∞:</h3>
      <ul id="privileges" style="list-style:none; padding-left:15px; color:#333;">
        <!-- —Å—é–¥–∞ –≤—Å—Ç–∞–≤–∏–º –ø—É–Ω–∫—Ç—ã -->
      </ul>
    </div>

    <hr style="margin:15px 0; border:0; border-top:1px solid #eee;">

    <div style="font-size:14px; color:#444; display:flex; justify-content:space-between; align-items:center;">
      <div>
        –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: <b id="registrationDate"></b>
      </div>
      <div>
        –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å—á—ë—Ç–∞: <b style="color:#2e7d32;" id="accountStatus">–ê–∫—Ç–∏–≤–Ω—ã–π</b>
      </div>
    </div>

  </div>
</div>

<script>
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤
  const statuses = {
    Classic: {
      name: "Classic",
      nextLevel: "Classic Master",
      maxMiles: 5000,
      color: "#8bc34a",
      privileges: [
        "–ë–æ–Ω—É—Å–Ω—ã–µ –º–∏–ª–∏ –∫–æ–ø—è—Ç—Å—è –∑–∞ –ø–æ–∫—É–ø–∫–∏ –Ω–∞ —Å–∞–π—Ç–µ –∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ú–æ–∂–Ω–æ —Ç—Ä–∞—Ç–∏—Ç—å –Ω–∞ –∞–≤–∏–∞–±–∏–ª–µ—Ç—ã –∏ –¥–æ–ø—É—Å–ª—É–≥–∏.",
        "–°—Ç–∞—Ç—É—Å–Ω—ã–µ –º–∏–ª–∏ –∫–æ–ø—è—Ç—Å—è –∑–∞ –ø–æ–ª–µ—Ç—ã –∏ –ø–æ–∫—É–ø–∫–∏ –ø–æ –∫–∞—Ä—Ç–µ S7 ‚Äî T-Bank."
      ]
    },
    VIP: {
      name: "VIP",
      nextLevel: "VIP Gold",
      maxMiles: 25000,
      color: "#fbc02d",
      privileges: [
        "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ—Å–∞–¥–∫–∞.",
        "–î–æ—Å—Ç—É–ø –≤ –±–∏–∑–Ω–µ—Å-–∑–∞–ª—ã –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤.",
        "–ë–æ–Ω—É—Å–Ω—ã–µ –∏ —Å—Ç–∞—Ç—É—Å–Ω—ã–µ –º–∏–ª–∏ –∑–∞ –ø–æ–ª—ë—Ç—ã –∏ –ø–æ–∫—É–ø–∫–∏."
      ]
    }
  };

  function updateStatus(type, miles, flights=0, registration="06 –∏—é–ª 2021", account="–ê–∫—Ç–∏–≤–Ω—ã–π") {
    const s = statuses[type];
    const percent = Math.min(100, (miles / s.maxMiles) * 100);

    document.getElementById("statusName").textContent = s.name;
    document.getElementById("milesValue").textContent = miles;
    document.getElementById("statusMiles").textContent = miles;
    document.getElementById("flights").textContent = flights;
    document.getElementById("currentMiles").textContent = miles + " –º–∏–ª—å";
    document.getElementById("nextLevelName").textContent = s.nextLevel;
    document.getElementById("nextLevelMiles").textContent = s.maxMiles;

    const progress = document.getElementById("milesProgress");
    progress.style.width = percent + "%";
    progress.style.background = s.color;
    document.getElementById("currentMiles").style.background = s.color;

    // –ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏
    const list = document.getElementById("privileges");
    list.innerHTML = "";
    s.privileges.forEach(p => {
      const li = document.createElement("li");
      li.innerHTML = "‚Ä¢ " + p;
      li.style.marginBottom = "5px";
      list.appendChild(li);
    });

    // –î–∞—Ç–∞ –∏ —Å—Ç–∞—Ç—É—Å
    document.getElementById("registrationDate").textContent = registration;
    document.getElementById("accountStatus").textContent = account;
  }

  // üîπ –¢–µ—Å—Ç: Classic
  updateStatus("Classic", 1057, 0, "06 –∏—é–ª 2021", "–ê–∫—Ç–∏–≤–Ω—ã–π");

  // üîπ –ü—Ä–∏–º–µ—Ä VIP:
  // updateStatus("VIP", 12340, 5, "15 –º–∞—Ä 2022", "–ê–∫—Ç–∏–≤–Ω—ã–π");
</script>


      <div id="shopTab" class="card" style="display:none">
        <h3>–ö–æ—Ä–∑–∏–Ω–∞</h3>
        <div id="cartContainer"><div class="cart-empty">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã...</div></div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="btn" id="checkoutBtn" onclick="checkout()" disabled>–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
          <button class="btn" id="clearCartBtn" onclick="clearCart()" style="background:#999">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
        </div>
        <div id="cartMsg" class="small-muted" style="margin-top:8px"></div>
      </div>

      <div id="settingsTab" class="card" style="display:none">
        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <div class="field">
          <div><div class="small-muted">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</div><input type="password" id="newPassword" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å"></div>
          <button class="btn" onclick="changePassword()">–°–º–µ–Ω–∏—Ç—å</button>
        </div>
        <div class="field">
          <div><div class="small-muted">–ü—Ä–∏–≤—è–∑–∫–∞ VK</div><button class="btn" onclick="bindVK()">–ü—Ä–∏–≤—è–∑–∞—Ç—å</button></div>
        </div>
        <div class="field">
          <div><div class="small-muted">–ü—Ä–∏–≤—è–∑–∫–∞ Telegram</div><button class="btn" onclick="bindTelegram()">–ü—Ä–∏–≤—è–∑–∞—Ç—å</button></div>
        </div>
      </div>
    </div>

    <div>
      <div class="card">
        <h3>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
        <div style="display:flex;flex-direction:column;gap:8px">
          <button class="btn" onclick="goTo('profileTab')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
          <button class="btn" onclick="goTo('shopTab')">–û—Ç–∫—Ä—ã—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
          <button class="btn btn-red" onclick="logout()">–í—ã–π—Ç–∏</button>
        </div>
      </div>

      <div class="card" style="margin-top:16px">
        <h3>–ó–∞–∫–∞–∑—ã</h3>
        <div id="ordersContainer" class="small-muted" style="margin-top:8px">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      </div>
    </div>
  </div>
</div>

<script>
const el = id => document.getElementById(id);
function showTab(evt){ 
  evt && evt.preventDefault();
  const tabId = evt ? evt.currentTarget.getAttribute('data-tab') : 'profileTab';
  document.querySelectorAll('.tabs a').forEach(a=>a.classList.remove('active'));
  if(evt) evt.currentTarget.classList.add('active');
  ['profileTab','milesTab','shopTab','settingsTab'].forEach(id=>{ const e = el(id); e.style.display = id===tabId?'block':'none'; });
  if(tabId==='shopTab') loadCart();
}

// profile
async function loadProfile(){
  try{
    const res = await fetch('/api/profile',{credentials:'include'});
    if(!res.ok){ window.location.href='auth.html'; return; }
    const j = await res.json();
    applyProfile(j.user || j);
  } catch(e){ window.location.href='auth.html'; }
}
function applyProfile(p){
  el('fioField').innerText = p.fio||'‚Äî';
  el('dobField').innerText = p.dob||'‚Äî';
  el('genderField').innerText = p.gender||'‚Äî';
  el('emailField').innerText = p.email||'‚Äî';
  el('phoneField').innerText = p.phone||'‚Äî';
  el('cardField').innerText = p.cardNumber||'‚Äî';
  el('cardTypeField').innerText = p.cardType||'‚Äî';
  el('fioHeader').innerText = p.fio||'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
  el('bonusMiles').innerText = p.bonusMiles||0;
  el('milesBar').style.width = Math.min((p.bonusMiles||0)/1000*100,100)+'%';
  el('milesBar').innerText = p.bonusMiles||0;
  if(p.avatar) el('avatar').src=p.avatar;
  renderOrders(p.orders||[]);
}
function renderOrders(orders){
  const o = el('ordersContainer'); o.innerHTML='';
  if(!orders.length){ o.innerText='–ó–∞–∫–∞–∑—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç'; return; }
  orders.slice().reverse().forEach(ord=>{
    const d = document.createElement('div');
    d.style.marginBottom='10px';
    d.innerHTML=`<strong>–ó–∞–∫–∞–∑ ${ord.id}</strong> ‚Äî ${new Date(ord.createdAt).toLocaleString()} ‚Äî ${ord.status}<br>–¢–æ–≤–∞—Ä–æ–≤: ${ord.items.length} ‚Äî –°—É–º–º–∞: ${ord.total} ‚ÇΩ`;
    o.appendChild(d);
  });
}

// edit profile
function enableEdit(field){
  const map={fio:['fioField','fioHeader'],dob:['dobField'],gender:['genderField'],email:['emailField'],phone:['phoneField'],cardNumber:['cardField']};
  const ids=map[field]; if(!ids) return;
  const cur = el(ids[0]).innerText==='‚Äî'?'':el(ids[0]).innerText;
  const input=document.createElement('input'); input.value=cur; input.style.width='220px';
  const ok=document.createElement('button'); ok.innerText='OK'; ok.className='btn'; ok.style.marginLeft='8px';
  const wrapper=document.createElement('div'); wrapper.appendChild(input); wrapper.appendChild(ok);
  const container = el(ids[0]); container.innerHTML=''; container.appendChild(wrapper); input.focus();
  ok.onclick=async()=>{
    const val=input.value.trim()||'';
    ids.forEach(id=>{ if(el(id)) el(id).innerText=val||'‚Äî'; });
    if(field==='fio' && el('fioHeader')) el('fioHeader').innerText=val||'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
    try{
      await fetch('/api/profile/update',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({[field]:val})});
      await loadProfile();
    }catch(e){console.error(e);}
  };
}

// avatar
el('avatarInput').addEventListener('change', function(){
  const f=this.files[0]; if(!f) return;
  const r=new FileReader();
  r.onload=async e=>{
    el('avatar').src=e.target.result;
    await fetch('/api/profile/update',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({avatar:e.target.result})});
  };
  r.readAsDataURL(f);
});

// cart
async function loadCart(){
  const container=el('cartContainer'); container.innerHTML='<div class="cart-empty">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã...</div>';
  try{
    const res=await fetch('/api/cart',{credentials:'include'});
    if(!res.ok){ container.innerHTML='–î–ª—è —Ä–∞–±–æ—Ç—ã –∫–æ—Ä–∑–∏–Ω—ã –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏ ‚Äî <a href="/auth.html">–≤–æ–π—Ç–∏</a>'; el('checkoutBtn').disabled=true; return; }
    const j=await res.json(); renderCart(j.cart||[]);
  }catch(e){ container.innerHTML='<div class="cart-empty">–û—à–∏–±–∫–∞ —Å–µ—Ç–∏</div>'; el('checkoutBtn').disabled=true; }
}
function renderCart(cart){
  const container=el('cartContainer'); if(!cart.length){ container.innerHTML='<div class="cart-empty">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>'; el('checkoutBtn').disabled=true; return; }
  const table=document.createElement('table'); table.className='cart-table';
  table.innerHTML='<thead><tr><th>–¢–æ–≤–∞—Ä</th><th>–¶–µ–Ω–∞</th><th>–ö–æ–ª-–≤–æ</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th></tr></thead>';
  const tbody=document.createElement('tbody'); let total=0;
  cart.forEach(item=>{
    const tr=document.createElement('tr'); const priceNum=parseFloat((item.price||0)); total+=priceNum*(item.qty||1);
    tr.innerHTML=`<td><img src="${item.image||''}" style="width:48px;height:48px;object-fit:cover;margin-right:8px;vertical-align:middle">${item.title}</td>
      <td>${item.price}</td><td>${item.qty||1}</td><td><button class="btn" onclick="removeFromCart('${item.id}')">–£–¥–∞–ª–∏—Ç—å</button></td>`;
    tbody.appendChild(tr);
  });
  table.appendChild(tbody); const footer=document.createElement('div'); footer.style.marginTop='12px'; footer.innerHTML=`<strong>–ò—Ç–æ–≥–æ: ${total} ‚ÇΩ</strong>`;
  container.innerHTML=''; container.appendChild(table); container.appendChild(footer); el('checkoutBtn').disabled=false;
}
async function checkout(){
  if(!confirm('–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑?')) return;
  const res=await fetch('/api/cart/checkout',{method:'POST',credentials:'include'}); const j=await res.json();
  if(!res.ok){ alert(j.error||'–û—à–∏–±–∫–∞'); return; }
  loadCart(); el('cartMsg').innerText='–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!'; setTimeout(()=>el('cartMsg').innerText='',2000); loadProfile();
}
async function clearCart(){ if(!confirm('–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É?')) return;
  await fetch('/api/cart/clear',{method:'POST',credentials:'include'}); loadCart(); el('cartMsg').innerText='–ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞'; setTimeout(()=>el('cartMsg').innerText='',2000);
}
async function removeFromCart(id){ await fetch('/api/cart/remove',{method:'POST',credentials:'include',headers:{'Content-Type':'application/json'},body:JSON.stringify({id})}); loadCart(); }

// settings
async function changePassword(){
  const val=el('newPassword').value.trim(); if(!val){alert('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å');return;}
  const res=await fetch('/api/profile/update',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({password:val})});
  if(res.ok){alert('–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω—ë–Ω'); el('newPassword').value='';} else alert('–û—à–∏–±–∫–∞');
}
function bindVK(){alert('–ü—Ä–∏–≤—è–∑–∫–∞ VK –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞');}
function bindTelegram(){alert('–ü—Ä–∏–≤—è–∑–∫–∞ Telegram –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞');}

function goTo(tab){ document.querySelectorAll('.tabs a').forEach(a=>a.classList.remove('active')); const a=[...document.querySelectorAll('.tabs a')].find(x=>x.dataset.tab===tab); if(a) a.classList.add('active'); showTab({currentTarget:a,preventDefault:()=>{}});}
async function logout(){ await fetch('/api/logout',{method:'POST',credentials:'include'}); window.location.href='auth.html'; }

document.addEventListener('DOMContentLoaded',async()=>{
  await loadProfile(); showTab({currentTarget:document.querySelector('.tabs a.active'),preventDefault:()=>{}});
});
</script>
</body>
</html>
