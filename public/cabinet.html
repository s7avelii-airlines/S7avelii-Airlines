<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–∞–±–∏–Ω–µ—Ç ‚Äî S7avelii</title>
  <link rel="icon" href="images/favicon.png" type="image/png">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ======= preserve original look ======= */
    :root{
      --bg:#f3f6f9;
      --card:#ffffff;
      --accent:#9cc42f;
      --muted:#6b7280;
      --container:1100px;
      --shadow: 0 6px 20px rgba(16,24,40,0.06);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
      background:var(--bg);
      color:#111827;
    }
    .wrap{max-width:var(--container);margin:18px auto;padding:18px}
    .top {
      background: #fff;
      border-radius:12px;
      box-shadow: var(--shadow);
      padding:18px 22px;
      display:flex;
      align-items:center;
      gap:16px;
      position:sticky;
      top:12px;
      z-index:30;
    }
    .logo { display:flex; align-items:center; gap:12px; font-weight:700; font-size:18px; color:#111 }
    .logo img{width:46px;height:46px;border-radius:999px;object-fit:cover}
    .top-right{margin-left:auto;display:flex;gap:12px;align-items:center}
    .lang-flag{width:28px;height:18px;border-radius:3px;object-fit:cover}
    .small-avatar{width:36px;height:36px;border-radius:999px;object-fit:cover;border:2px solid #fff;box-shadow:0 2px 6px rgba(0,0,0,0.08)}
    .profile-card{
      margin-top:18px;
      background:var(--card);
      padding:22px;
      border-radius:16px;
      box-shadow:var(--shadow);
      display:flex;
      gap:22px;
      align-items:center;
      flex-wrap:wrap;
    }
    .avatar{
      width:118px;height:118px;border-radius:999px;object-fit:cover;border:4px solid #fff;box-shadow:0 6px 18px rgba(0,0,0,0.06);cursor:pointer;
    }
    .user-info{min-width:260px}
    .user-info h1{margin:0;font-size:20px;display:flex;align-items:center;gap:12px}
    .user-info .sub{color:var(--muted);margin-top:6px}
    .card-badge{width:72px;height:auto;border-radius:8px;display:inline-block;vertical-align:middle}
    .stats{margin-left:auto;display:flex;gap:18px;align-items:center;flex-wrap:wrap}
    .stat{background:linear-gradient(180deg,#fff,#fcfff0);padding:12px 18px;border-radius:12px;text-align:center;border:1px solid rgba(0,0,0,0.04)}
    .stat .num{font-weight:700;font-size:20px}
    .stat .label{font-size:12px;color:var(--muted);margin-top:6px}
    .tabs{display:flex;gap:12px;margin-top:16px;padding:10px 6px}
    .tabs a{padding:10px 14px;border-radius:10px;text-decoration:none;color:#475569;background:transparent}
    .tabs a.active{background:rgba(156,196,47,0.06);color:var(--accent);font-weight:600}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:22px;margin-top:18px}
    .card{background:var(--card);padding:18px;border-radius:14px;box-shadow:0 4px 12px rgba(0,0,0,0.04);border:1px solid rgba(0,0,0,0.03)}
    .card h3{margin:0 0 12px;font-size:18px}
    .field{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-top:1px solid rgba(0,0,0,0.04)}
    .field:first-of-type{border-top:0}
    .label{color:var(--muted);font-size:13px}
    .value{font-size:15px;max-width:70%;word-wrap:break-word}
    .edit-btn{background:transparent;border:0;color:var(--accent);cursor:pointer;font-weight:600;padding:8px 10px;border-radius:8px}
    .small-muted{color:var(--muted);font-size:13px;margin-top:8px}
    .notice{background:linear-gradient(180deg,#fff,#f6f8fb);border-radius:12px;padding:12px 16px;border:1px solid rgba(0,0,0,0.03);display:flex;align-items:center;gap:12px}
    .notice .dot{width:36px;height:36px;display:grid;place-items:center;border-radius:999px;background:rgba(156,196,47,0.12);color:var(--accent);font-weight:700}
    .product-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
    .product{border-radius:12px;border:1px solid rgba(0,0,0,0.03);background:#fff;padding:12px;display:flex;flex-direction:column;gap:8px}
    .product img{width:100%;height:140px;object-fit:cover;border-radius:8px}
    .product .title{font-weight:600}
    .product .price{font-weight:700}
    .cart-item{display:flex;gap:10px;align-items:center;padding:10px 0;border-bottom:1px dashed rgba(0,0,0,0.04)}
    .cart-item img{width:64px;height:64px;object-fit:cover;border-radius:8px}
    .btn{display:inline-block;background:var(--accent);color:#fff;padding:10px 14px;border-radius:10px;border:0;cursor:pointer}
    .btn.secondary{background:#eef2f7;color:#111;border:0}
    .muted{color:var(--muted)}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} .stats{margin-left:0;margin-top:12px} }
  </style>
</head>
<body>
<div class="wrap">

  <!-- TOP -->
  <div class="top" role="banner">
    <div class="logo">
      <img src="images/photo_5276207082657412564_y.avif" alt="logo">
      <div>S7avelii Airlines</div>
    </div>

    <div class="top-right">
      <img src="images/flag_ru.png" alt="ru" class="lang-flag" onerror="this.style.display='none'">
      <img id="topSmallAvatar" src="https://via.placeholder.com/36" alt="avatar" class="small-avatar" title="–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å">
    </div>
  </div>

  <!-- PROFILE header -->
  <section class="profile-card" aria-label="profile header">
    <div class="avatar-wrap">
      <label for="avatarInput" title="–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ">
        <img id="avatar" class="avatar" src="https://via.placeholder.com/150" alt="avatar">
      </label>
      <input id="avatarInput" type="file" accept="image/*" style="display:none">
      <div class="user-info">
        <h1 id="fioHeader">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
        <div class="sub" id="phoneHeader">‚Äî</div>
        <div style="margin-top:10px">
          <img id="cardTypeImg" class="card-badge" src="" style="display:none" alt="card">
          <span id="cardTypeText" class="muted" style="margin-left:8px"></span>
        </div>
      </div>
    </div>

    <div class="stats" aria-hidden="false">
      <div class="stat"><div class="num" id="bonusMiles">‚Äî</div><div class="label">–±–æ–Ω—É—Å–Ω—ã–µ –º–∏–ª–∏</div></div>
      <div class="stat"><div class="num" id="statusMiles">‚Äî</div><div class="label">—Å—Ç–∞—Ç—É—Å–Ω—ã–µ –º–∏–ª–∏</div></div>
    </div>
  </section>

  <!-- Tabs -->
  <nav class="tabs" role="tablist" aria-label="tabs">
    <a href="#" class="active" data-tab="profileTab" onclick="showTab(event)">–ü—Ä–æ—Ñ–∏–ª—å</a>
    <a href="#" data-tab="milesTab" onclick="showTab(event)">–ú–æ–∏ –º–∏–ª–∏</a>
    <a href="#" data-tab="shopTab" onclick="showTab(event)">S7avelii Shop</a>
    <a href="#" data-tab="settingsTab" onclick="showTab(event)">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
  </nav>

  <!-- Notifications -->
  <div class="notice-row" style="margin-top:12px">
    <div class="notice">
      <div class="dot">‚úà</div>
      <div>
        <div style="font-weight:700">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –¢–µ–ª–µ–≥—Ä–∞–º–µ</div>
        <div class="muted">–ü–æ–ª—É—á–∞–π—Ç–µ –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—ë—Ç–µ –ø—Ä—è–º–æ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–µ.</div>
      </div>
      <div style="margin-left:auto"><button class="btn secondary" id="subscribeTelegramBtn">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</button></div>
    </div>

    <div class="notice" style="background:#fff7f4;border-color:rgba(234,88,12,0.08);margin-top:10px">
      <div class="dot" style="background:rgba(234,88,12,0.1;color:#ea580c">!</div>
      <div class="muted">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –≤–∞—à–µ–≥–æ –∑–∞–≥—Ä–∞–Ω–∏—á–Ω–æ–≥–æ –ø–∞—Å–ø–æ—Ä—Ç–∞ –∏—Å—Ç—ë–∫. –ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π.</div>
      <div style="margin-left:auto"><button class="btn secondary" id="dismissPassportNotice">‚úï</button></div>
    </div>
  </div>

  <!-- Grid -->
  <div class="grid">

    <!-- LEFT: Profile details -->
    <div>
      <div id="profileTab" class="card" role="region" aria-label="profile">
        <h3>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
        <div style="padding:8px 0 0 0" class="muted">–§–ò–û / –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è</div>
        <div class="field">
          <div>
            <div class="label">–§–ò–û</div>
            <div id="fioField" class="value">‚Äî</div>
          </div>
          <button class="edit-btn" onclick="enableEdit('fio')">–ò–∑–º–µ–Ω–∏—Ç—å</button>
        </div>

        <div class="field">
          <div>
            <div class="label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</div>
            <div id="dobField" class="value">‚Äî</div>
          </div>
          <button class="edit-btn" onclick="enableEdit('dob')">–ò–∑–º–µ–Ω–∏—Ç—å</button>
        </div>

        <div class="field">
          <div>
            <div class="label">–ü–æ–ª</div>
            <div id="genderField" class="value">‚Äî</div>
          </div>
          <button class="edit-btn" onclick="enableEdit('gender')">–ò–∑–º–µ–Ω–∏—Ç—å</button>
        </div>

        <h3 style="margin-top:16px">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>

        <div class="field">
          <div>
            <div class="label">E-mail</div>
            <div id="emailField" class="value">‚Äî</div>
          </div>
          <button class="edit-btn" onclick="enableEdit('email')">–ò–∑–º–µ–Ω–∏—Ç—å</button>
        </div>

        <div class="field">
          <div>
            <div class="label">–¢–µ–ª–µ—Ñ–æ–Ω</div>
            <div id="phoneField" class="value">‚Äî</div>
          </div>
          <button class="edit-btn" onclick="enableEdit('phone')">–ò–∑–º–µ–Ω–∏—Ç—å</button>
        </div>

        <h3 style="margin-top:16px">–ö–∞—Ä—Ç–∞</h3>
        <div class="field">
          <div>
            <div class="label">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</div>
            <div id="cardField" class="value">‚Äî</div>
          </div>
          <button class="edit-btn" onclick="enableEdit('cardNumber')">–ò–∑–º–µ–Ω–∏—Ç—å</button>
        </div>
        <div class="field">
          <div>
            <div class="label">–¢–∏–ø –∫–∞—Ä—Ç—ã</div>
            <div id="cardTypeField" class="value">‚Äî</div>
          </div>
        </div>
      </div>

      <div style="max-width:600px; margin:20px auto; font-family:Arial, sans-serif; color:#333;">
  <div style="background:#fff; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); padding:20px;">
    
    <h2 style="font-size:18px; font-weight:600; margin-bottom:10px;">
      –°—Ç–∞—Ç—É—Å –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ <a href="#" style="color:#1a73e8; text-decoration:none;">S7 Priority</a>
    </h2>

    <div style="margin-bottom:20px;">
      <div style="font-size:14px; color:#666;">–í–∞—à —Å—Ç–∞—Ç—É—Å:</div>
      <div id="statusName" style="font-size:20px; font-weight:bold;">Classic</div>
    </div>

    <div style="background:#f9fafb; border-radius:10px; padding:15px; margin-bottom:20px;">
      <div style="font-size:24px; font-weight:bold; margin-bottom:5px;">
        <span id="milesValue">0</span> –±–æ–Ω—É—Å–Ω—ã–µ –º–∏–ª–∏
      </div>
    </div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
    <div style="margin-bottom:10px; font-size:14px;">
      <span id="currentMiles" style="background:#8bc34a; color:#fff; border-radius:8px; padding:2px 8px; font-weight:bold;">0 –º–∏–ª—å</span>
      <span style="margin-left:10px; color:#666;">0 –ø–æ–ª—ë—Ç–æ–≤</span>
    </div>

    <div style="background:#e9ecef; border-radius:6px; height:12px; width:100%; overflow:hidden;">
      <div id="milesProgress" style="background:#8bc34a; height:100%; width:0%;"></div>
    </div>

    <div style="display:flex; justify-content:space-between; margin-top:5px; font-size:12px; color:#999;">
      <span id="nextLevelName">Classic Master</span>
      <span id="nextLevelMiles">5000</span>
    </div>

    <div style="margin-top:15px; font-size:14px; color:#666;">
      –°—Ç–∞—Ç—É—Å–Ω—ã—Ö –º–∏–ª—å: <b id="statusMiles">0</b><br>
      –ü–æ–ª—ë—Ç–æ–≤: <b id="flights">0</b>
    </div>

    <!-- –ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏ -->
    <div style="margin-top:20px;">
      <h3 style="font-size:15px; margin-bottom:10px; color:#444;">–ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏ —Å—Ç–∞—Ç—É—Å–∞:</h3>
      <ul id="privileges" style="list-style:none; padding-left:15px; color:#333;">
        <!-- —Å—é–¥–∞ –≤—Å—Ç–∞–≤–∏–º –ø—É–Ω–∫—Ç—ã -->
      </ul>
    </div>

    <hr style="margin:15px 0; border:0; border-top:1px solid #eee;">

    <div style="font-size:14px; color:#444; display:flex; justify-content:space-between; align-items:center;">
      <div>
        –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: <b id="registrationDate"></b>
      </div>
      <div>
        –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å—á—ë—Ç–∞: <b style="color:#2e7d32;" id="accountStatus">–ê–∫—Ç–∏–≤–Ω—ã–π</b>
      </div>
    </div>

  </div>
</div>

<script>
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤
  const statuses = {
    Classic: {
      name: "Classic",
      nextLevel: "Classic Master",
      maxMiles: 5000,
      color: "#8bc34a",
      privileges: [
        "–ë–æ–Ω—É—Å–Ω—ã–µ –º–∏–ª–∏ –∫–æ–ø—è—Ç—Å—è –∑–∞ –ø–æ–∫—É–ø–∫–∏ –Ω–∞ —Å–∞–π—Ç–µ –∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ú–æ–∂–Ω–æ —Ç—Ä–∞—Ç–∏—Ç—å –Ω–∞ –∞–≤–∏–∞–±–∏–ª–µ—Ç—ã –∏ –¥–æ–ø—É—Å–ª—É–≥–∏.",
        "–°—Ç–∞—Ç—É—Å–Ω—ã–µ –º–∏–ª–∏ –∫–æ–ø—è—Ç—Å—è –∑–∞ –ø–æ–ª–µ—Ç—ã –∏ –ø–æ–∫—É–ø–∫–∏ –ø–æ –∫–∞—Ä—Ç–µ S7 ‚Äî T-Bank."
      ]
    },
    VIP: {
      name: "VIP",
      nextLevel: "VIP Gold",
      maxMiles: 25000,
      color: "#fbc02d",
      privileges: [
        "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ—Å–∞–¥–∫–∞.",
        "–î–æ—Å—Ç—É–ø –≤ –±–∏–∑–Ω–µ—Å-–∑–∞–ª—ã –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤.",
        "–ë–æ–Ω—É—Å–Ω—ã–µ –∏ —Å—Ç–∞—Ç—É—Å–Ω—ã–µ –º–∏–ª–∏ –∑–∞ –ø–æ–ª—ë—Ç—ã –∏ –ø–æ–∫—É–ø–∫–∏."
      ]
    }
  };

  function updateStatus(type, miles, flights=0, registration="06 –∏—é–ª 2021", account="–ê–∫—Ç–∏–≤–Ω—ã–π") {
    const s = statuses[type];
    const percent = Math.min(100, (miles / s.maxMiles) * 100);

    document.getElementById("statusName").textContent = s.name;
    document.getElementById("milesValue").textContent = miles;
    document.getElementById("statusMiles").textContent = miles;
    document.getElementById("flights").textContent = flights;
    document.getElementById("currentMiles").textContent = miles + " –º–∏–ª—å";
    document.getElementById("nextLevelName").textContent = s.nextLevel;
    document.getElementById("nextLevelMiles").textContent = s.maxMiles;

    const progress = document.getElementById("milesProgress");
    progress.style.width = percent + "%";
    progress.style.background = s.color;
    document.getElementById("currentMiles").style.background = s.color;

    // –ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏
    const list = document.getElementById("privileges");
    list.innerHTML = "";
    s.privileges.forEach(p => {
      const li = document.createElement("li");
      li.innerHTML = "‚Ä¢ " + p;
      li.style.marginBottom = "5px";
      list.appendChild(li);
    });

    // –î–∞—Ç–∞ –∏ —Å—Ç–∞—Ç—É—Å
    document.getElementById("registrationDate").textContent = registration;
    document.getElementById("accountStatus").textContent = account;
  }

  // üîπ –¢–µ—Å—Ç: Classic
  updateStatus("Classic", 1057, 0, "06 –∏—é–ª 2021", "–ê–∫—Ç–∏–≤–Ω—ã–π");

  // üîπ –ü—Ä–∏–º–µ—Ä VIP:
  // updateStatus("VIP", 12340, 5, "15 –º–∞—Ä 2022", "–ê–∫—Ç–∏–≤–Ω—ã–π");
</script>


      <!-- Shop tab -->
      <div id="shopTab" class="card" style="margin-top:16px;display:none">
        <h3>S7avelii Shop</h3>
        <div class="muted">–¢–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∫—É–ø–∏—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å</div>
        <div id="productGrid" style="margin-top:12px" class="product-grid"></div>

        <h3 style="margin-top:16px">–í –∫–æ—Ä–∑–∏–Ω–µ</h3>
        <div id="cartList" style="min-height:40px"></div>
        <div style="display:flex;gap:10px;margin-top:10px;align-items:center">
          <div id="cartTotal" class="muted">–ò—Ç–æ–≥–æ: 0 ‚ÇΩ</div>
          <div style="margin-left:auto">
            <button id="checkoutBtn" class="btn" onclick="checkout()">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
          </div>
        </div>
      </div>

      <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
      <div id="settingsTab" class="card" style="margin-top:16px;display:none">
        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>

        <!-- change password -->
        <div style="margin-top:8px">
          <h4>–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h4>
          <form id="passwordForm" onsubmit="return changePassword(event)" style="display:flex;flex-direction:column;gap:8px;max-width:360px">
            <input id="oldPassword" type="password" placeholder="–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å" class="border p-2 rounded">
            <input id="newPassword" type="password" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" class="border p-2 rounded">
            <input id="confirmPassword" type="password" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" class="border p-2 rounded">
            <div style="display:flex;gap:8px">
              <button class="btn" type="submit">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
              <button type="button" class="btn secondary" onclick="clearPasswordForm()">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div id="passwordMsg" class="small-muted"></div>
          </form>
        </div>

        <!-- social link -->
        <div style="margin-top:18px">
          <h4>–ü—Ä–∏–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤</h4>
          <div style="display:flex;flex-direction:column;gap:10px;max-width:360px">
            <div style="display:flex;align-items:center;gap:10px">
              <button class="btn" id="vkBtn" style="background:#4c75a3" onclick="toggleVK()">–ü—Ä–∏–≤—è–∑–∞—Ç—å –í–ö–æ–Ω—Ç–∞–∫—Ç–µ</button>
              <span id="vkStatus" class="small-muted">‚Äî</span>
            </div>
            <div style="display:flex;align-items:center;gap:10px">
              <button class="btn" id="tgBtn" style="background:#2ca5e0" onclick="toggleTelegram()">–ü—Ä–∏–≤—è–∑–∞—Ç—å Telegram</button>
              <span id="tgStatus" class="small-muted">‚Äî</span>
            </div>
            <div id="linkMsg" class="small-muted"></div>
          </div>
        </div>

      </div>

    </div>

    <!-- RIGHT: Summary / quick-actions -->
    <aside>
      <div class="card">
        <h3>–ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
        <div class="muted" style="margin-top:8px">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:12px">
          <button class="edit-btn" onclick="goTo('profileTab')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
          <button class="edit-btn" onclick="goTo('milesTab')">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–∏–ª–∏</button>
          <button class="edit-btn" onclick="goTo('shopTab')">–û—Ç–∫—Ä—ã—Ç—å Shop</button>
        </div>
      </div>

      <div class="card" style="margin-top:16px">
        <h3>–ó–∞–∫–∞–∑—ã</h3>
        <div id="ordersContainer" class="small-muted" style="margin-top:8px">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      </div>

      <div class="card" style="margin-top:16px">
        <h3>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
        <div id="adminPanel" style="display:none;margin-top:8px">
          <h4>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h4>
          <div id="adminUsersList" class="muted"></div>
        </div>
      </div>

    </aside>

  </div>
</div>

<script>
/* ============================
   Helpers & config
   ============================ */
const el = id => document.getElementById(id);
let currentUser = null;

function formatPrice(n){ return (typeof n === 'number' ? n.toLocaleString('ru-RU') : n) + ' ‚ÇΩ'; }
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c]); }

/* ============================
   Products (Shop) - keep old list
   ============================ */
const PRODUCTS = [
  { id:'p1', title:'–ë–ª–æ–∫–Ω–æ—Ç S7avelii', price:550, image:'images/photo_5330078908990750485_y.avif' },
  { id:'p2', title:'–ö–æ–º–±–æ –ë–ª–æ–∫–Ω–æ—Ç + –§—É—Ç–±–æ–ª–∫–∞', price:2350, image:'images/photo_5330078908990750484_y.avif' },
  { id:'p3', title:'–§–∏—Ä–º–µ–Ω–Ω–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞', price:1900, image:'images/photo_5332515869139530693_y.avif' },
  { id:'p4', title:'–ö–æ–º–±–æ –ü—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫', price:4500, image:'images/photo_5330078908990750483_y.avif' }
];

function renderProducts(){
  const grid = el('productGrid');
  if(!grid) return;
  grid.innerHTML = '';
  PRODUCTS.forEach(p=>{
    const card = document.createElement('div');
    card.className = 'product';
    card.innerHTML = `
      <img src="${p.image}" alt="${escapeHtml(p.title)}">
      <div class="title">${escapeHtml(p.title)}</div>
      <div class="price">${formatPrice(p.price)}</div>
      <div style="display:flex;gap:8px;margin-top:auto">
        <button class="btn" data-buy="${p.id}">–ö—É–ø–∏—Ç—å</button>
        <button class="btn secondary" data-add="${p.id}">–í –∫–æ—Ä–∑–∏–Ω—É</button>
      </div>
    `;
    grid.appendChild(card);
  });
  grid.querySelectorAll('[data-add]').forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const id = btn.getAttribute('data-add');
      const p = PRODUCTS.find(x=>x.id===id);
      if(!p) return;
      addToCartBackend({ title: p.title, price: String(p.price) + ' ‚ÇΩ', qty:1, image: p.image });
    });
  });
  grid.querySelectorAll('[data-buy]').forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const id = btn.getAttribute('data-buy');
      const p = PRODUCTS.find(x=>x.id===id);
      if(!p) return;
      addToCartBackend({ title: p.title, price: String(p.price) + ' ‚ÇΩ', qty:1, image: p.image }).then(()=>{
        goTo('shopTab');
      });
    });
  });
}

/* ============================
   Tabs & navigation
   ============================ */
function showTab(evt){
  evt && evt.preventDefault();
  const tabId = evt ? evt.currentTarget.getAttribute('data-tab') : 'profileTab';
  document.querySelectorAll('.tabs a').forEach(a=>a.classList.remove('active'));
  if(evt) evt.currentTarget.classList.add('active');
  ['profileTab','milesTab','shopTab','settingsTab'].forEach(id=>{
    const node = document.getElementById(id);
    if (node) node.style.display = (id === tabId ? 'block' : 'none');
  });
  if (tabId === 'shopTab') loadCart();
}
function goTo(tab){
  const a = [...document.querySelectorAll('.tabs a')].find(x=>x.getAttribute('data-tab')===tab);
  if (a) { a.classList.add('active'); showTab({ currentTarget: a, preventDefault: ()=>{} }); }
}

/* ============================
   Load profile from server
   ============================ */
async function loadProfile(){
  try {
    const res = await fetch('/api/profile', { credentials: 'include' });
    if(!res.ok){
      // not logged in -> redirect to auth page
      // keep page usable: show guest state
      showGuestState();
      return;
    }
    const j = await res.json();
    currentUser = j.user || j;
    applyProfile(currentUser);
  } catch (err) {
    console.error('loadProfile err', err);
    showGuestState();
  }
}

function showGuestState(){
  currentUser = null;
  el('fioHeader').innerText = '–ì–æ—Å—Ç—å';
  el('avatar').src = 'https://via.placeholder.com/150';
  el('topSmallAvatar').src = 'https://via.placeholder.com/36';
  el('phoneHeader').innerText = '';
  el('bonusMiles').innerText = '‚Äî';
  renderProducts();
}

/* ============================
   Apply profile -> fill UI
   ============================ */
function applyProfile(p){
  if (!p) { showGuestState(); return; }
  // header avatars
  el('topSmallAvatar').src = p.avatar || 'https://via.placeholder.com/36';
  el('avatar').src = p.avatar || 'https://via.placeholder.com/150';
  // main fields
  el('fioHeader').innerText = p.fio || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
  el('phoneHeader').innerText = p.phone || '';
  el('fioField').innerText = p.fio || '‚Äî';
  el('dobField').innerText = p.dob || '‚Äî';
  el('genderField').innerText = p.gender || '‚Äî';
  el('emailField').innerText = p.email || '‚Äî';
  el('phoneField').innerText = p.phone || '‚Äî';
  el('cardField').innerText = p.cardNumber || '‚Äî';
  el('cardTypeField').innerText = p.cardType || '‚Äî';
  // miles
  el('bonusMiles').innerText = p.bonusMiles ?? '‚Äî';
  el('milesBonusStat').innerText = p.bonusMiles ?? '‚Äî';
  el('milesStatusStat').innerText = p.statusMiles ?? '‚Äî';
  // card badge
  const badge = el('cardTypeImg');
  const cardTypeText = el('cardTypeText');
  if (p.cardType === 'VIP') {
    badge.src = 'images/vip_card.png';
    badge.style.display = 'inline-block';
    cardTypeText.innerText = 'VIP';
  } else if (p.cardType === 'Classic') {
    badge.src = 'images/classic_card.png';
    badge.style.display = 'inline-block';
    cardTypeText.innerText = 'Classic';
  } else {
    badge.style.display = 'none';
    cardTypeText.innerText = '';
  }
  // orders
  renderOrders(p.orders || []);
  // link statuses (VK / Telegram)
  if (el('vkStatus')) el('vkStatus').innerText = p.linkedVK ? '‚úÖ –ü—Ä–∏–≤—è–∑–∞–Ω' : '‚ùå –ù–µ –ø—Ä–∏–≤—è–∑–∞–Ω';
  if (el('tgStatus')) el('tgStatus').innerText = p.linkedTelegram ? '‚úÖ –ü—Ä–∏–≤—è–∑–∞–Ω' : '‚ùå –ù–µ –ø—Ä–∏–≤—è–∑–∞–Ω';
  // admin panel
  if (p.role === 'admin') {
    el('adminPanel').style.display = 'block';
    loadAdminUsers();
  } else {
    el('adminPanel').style.display = 'none';
  }
  // render shop
  renderProducts();
  // load cart for this user
  loadCart();
}

/* ============================
   Inline edit fields
   ============================ */
function enableEdit(field) {
  const map = {
    fio: {id:'fioField', key:'fio', extraHeader:'fioHeader'},
    dob: {id:'dobField', key:'dob'},
    gender: {id:'genderField', key:'gender'},
    email: {id:'emailField', key:'email'},
    phone: {id:'phoneField', key:'phone', extraHeader:'phoneHeader'},
    cardNumber: {id:'cardField', key:'cardNumber'}
  };
  const m = map[field];
  if (!m) return;
  const container = el(m.id);
  const current = container.textContent === '‚Äî' ? '' : container.textContent;
  container.innerHTML = '';
  const input = document.createElement('input');
  input.value = current;
  input.style.width = '220px';
  input.type = (field === 'email') ? 'email' : (field === 'phone') ? 'tel' : 'text';
  const ok = document.createElement('button');
  ok.className = 'btn';
  ok.textContent = 'OK';
  ok.style.marginLeft = '8px';
  ok.onclick = async () => {
    const value = input.value.trim();
    container.textContent = value || '‚Äî';
    if (m.extraHeader && el(m.extraHeader)) el(m.extraHeader).textContent = value || (m.extraHeader === 'fioHeader' ? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å' : '');
    // push to server
    try {
      const body = { [m.key]: value || '' };
      const r = await fetch('/api/profile/update', { method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include', body: JSON.stringify(body) });
      if (!r.ok) {
        console.warn('update failed', r.status);
      } else {
        const j = await r.json();
        if (j.user) applyProfile(j.user);
      }
    } catch(e){ console.error('profile update failed', e); }
  };
  container.appendChild(input);
  container.appendChild(ok);
  input.focus();
}

/* ============================
   Avatar upload
   ============================ */
el('avatarInput').addEventListener('change', function(){
  const f = this.files[0];
  if (!f) return;
  const reader = new FileReader();
  reader.onload = async (ev) => {
    const dataUrl = ev.target.result;
    el('avatar').src = dataUrl;
    el('topSmallAvatar').src = dataUrl;
    // push to server
    try {
      const r = await fetch('/api/profile/update', { method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include', body: JSON.stringify({ avatar: dataUrl }) });
      if (!r.ok) console.warn('avatar push failed', r.status);
      else {
        const j = await r.json();
        if (j.user) applyProfile(j.user);
      }
    } catch (e) { console.warn('avatar push failed', e); }
  };
  reader.readAsDataURL(f);
});

/* ============================
   Cart (server-backed)
   ============================ */
async function loadCart(){
  const list = el('cartList');
  if (!list) return;
  list.innerHTML = '<div class="muted">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã...</div>';
  try {
    const res = await fetch('/api/cart', { credentials: 'include' });
    if (!res.ok) {
      list.innerHTML = `<div class="muted">–ö–æ—Ä–∑–∏–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö ‚Äî <a href="/auth.html">–≤–æ–π—Ç–∏</a></div>`;
      el('checkoutBtn').disabled = true;
      return;
    }
    const j = await res.json();
    renderCart(j.cart || []);
  } catch(e) {
    list.innerHTML = `<div class="muted">–û—à–∏–±–∫–∞ —Å–µ—Ç–∏</div>`;
    el('checkoutBtn').disabled = true;
  }
}

function renderCart(items){
  const list = el('cartList');
  list.innerHTML = '';
  if (!items || items.length === 0) {
    list.innerHTML = '<div class="muted">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>';
    el('cartTotal').textContent = '–ò—Ç–æ–≥–æ: 0 ‚ÇΩ';
    el('checkoutBtn').disabled = true;
    return;
  }
  let total = 0;
  items.forEach(it=>{
    const row = document.createElement('div');
    row.className = 'cart-item';
    const priceNum = parseFloat(String(it.price||'').replace(/[^\d,.-]/g,'').replace(',','.')) || 0;
    const qty = it.qty || 1;
    total += priceNum * qty;
    row.innerHTML = `
      <img src="${it.image || ''}" alt="${escapeHtml(it.title)}">
      <div style="flex:1">
        <div style="font-weight:600">${escapeHtml(it.title)}</div>
        <div class="muted">${formatPrice(priceNum)} √ó <input type="number" value="${qty}" min="1" style="width:64px" data-qty="${it.id}"></div>
      </div>
      <div style="text-align:right">
        <div style="font-weight:700">${formatPrice(priceNum * qty)}</div>
        <div style="margin-top:8px"><button class="edit-btn" data-remove="${it.id}">–£–¥–∞–ª–∏—Ç—å</button></div>
      </div>
    `;
    list.appendChild(row);
  });
  el('cartTotal').textContent = '–ò—Ç–æ–≥–æ: ' + formatPrice(total);
  el('checkoutBtn').disabled = false;
  // events
  list.querySelectorAll('[data-remove]').forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const id = btn.getAttribute('data-remove');
      removeFromCart(id);
    });
  });
  list.querySelectorAll('[data-qty]').forEach(inp=>{
    inp.addEventListener('change', async ()=> {
      const id = inp.getAttribute('data-qty');
      let q = parseInt(inp.value,10) || 1;
      if (q < 1) q = 1;
      // change qty on server: remove and add simplified approach (server doesn't have qty update endpoint)
      // We'll simulate by removing that item and adding same with qty
      try {
        // server expects items with their own id; to update qty properly server-side you'd implement endpoint.
        // For now we attempt to clear cart and re-add with new qty by requesting full cart and rebuilding.
        const res = await fetch('/api/cart', { credentials:'include' });
        if (!res.ok) { alert('–ù—É–∂–Ω–æ –≤–æ–π—Ç–∏'); return; }
        const j = await res.json();
        const items = j.cart || [];
        // find item template for this id
        const it = items.find(x=>String(x.id) === String(id));
        if (!it) { loadCart(); return; }
        // remove this item
        await fetch('/api/cart/' + encodeURIComponent(id), { method:'DELETE', credentials:'include' });
        // add same item qty times (server will create new ids)
        for (let i=0;i<q;i++){
          await fetch('/api/cart/add', { method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include', body: JSON.stringify({ title: it.title, price: it.price, image: it.image, qty:1 })});
        }
        loadCart();
      } catch(e) { console.error(e); alert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞'); }
    });
  });
}

async function addToCartBackend(item){
  try {
    const res = await fetch('/api/cart/add', { method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include', body: JSON.stringify(item) });
    if (!res.ok) {
      const j = await res.json().catch(()=>({}));
      alert(j.error || '–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É');
      if (res.status === 401) window.location.href = '/auth.html';
      return;
    }
    alert('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É');
    // refresh cart if visible
    if (document.querySelector('.tabs a.active').getAttribute('data-tab') === 'shopTab') loadCart();
  } catch(e) { alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'); }
}

async function removeFromCart(id){
  try {
    const res = await fetch('/api/cart/' + encodeURIComponent(id), { method:'DELETE', credentials:'include' });
    if (!res.ok) {
      const j = await res.json().catch(()=>({}));
      alert(j.error || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
      return;
    }
    loadCart();
  } catch(e) { alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'); }
}

async function clearCart(){
  if(!confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∫–æ—Ä–∑–∏–Ω—É?')) return;
  try {
    const res = await fetch('/api/cart/clear', { method:'POST', credentials:'include' });
    if (res.ok) {
      loadCart();
      el('cartMsg').innerText = '–ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞';
      setTimeout(()=> el('cartMsg').innerText = '', 2000);
    } else {
      const j = await res.json().catch(()=>({}));
      alert(j.error || '–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏');
    }
  } catch(e){ alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'); }
}

async function checkout(){
  if(!confirm('–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é –∑–∞–∫–∞–∑–∞?')) return;
  try {
    // no universal checkout endpoint in generic server; simulate by clearing cart
    const res = await fetch('/api/cart/clear', { method:'POST', credentials:'include' });
    if (!res.ok) {
      const j = await res.json().catch(()=>({}));
      alert(j.error || '–û—à–∏–±–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è');
      return;
    }
    loadCart();
    el('cartMsg').innerText = '–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç, —Å–ø–∞—Å–∏–±–æ!';
    setTimeout(()=> el('cartMsg').innerText = '', 3000);
    // refresh profile/orders
    setTimeout(()=> loadProfile(), 800);
  } catch(e){ alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'); }
}

/* ============================
   Orders rendering
   ============================ */
function renderOrders(orders){
  const o = el('ordersContainer');
  if(!o) return;
  if(!orders || !orders.length) { o.innerText = '–ó–∞–∫–∞–∑—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç'; return; }
  o.innerHTML = '';
  orders.slice().reverse().forEach(ord=>{
    const div = document.createElement('div');
    div.style.marginBottom='10px';
    div.innerHTML = `<strong>–ó–∞–∫–∞–∑ ${escapeHtml(String(ord.id||'‚Äî'))}</strong> ‚Äî ${ord.createdAt ? new Date(ord.createdAt).toLocaleString() : '‚Äî'} ‚Äî ${escapeHtml(ord.status||'‚Äî')}<br>
      –¢–æ–≤–∞—Ä–æ–≤: ${Array.isArray(ord.items)? ord.items.length : '‚Äî'} ‚Äî –°—É–º–º–∞: ${formatTotal(ord.total)}`;
    o.appendChild(div);
  });
}
function formatTotal(t){ return (isNaN(t) ? t : t + ' ‚ÇΩ'); }

/* ============================
   Password change & social link toggles
   ============================ */
async function changePassword(e){
  if (e) e.preventDefault();
  const oldPass = el('oldPassword').value.trim();
  const newPass = el('newPassword').value.trim();
  const confirm = el('confirmPassword').value.trim();
  const msg = el('passwordMsg');
  if (!oldPass || !newPass || !confirm) { msg.innerText = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'; return false; }
  if (newPass !== confirm) { msg.innerText = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç'; return false; }
  try {
    const res = await fetch('/api/change-password', { method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include', body: JSON.stringify({ oldPassword: oldPass, newPassword: newPass })});
    const j = await res.json();
    if (!res.ok) msg.innerText = j.error || '–û—à–∏–±–∫–∞';
    else { msg.innerText = '–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω—ë–Ω'; el('passwordForm').reset(); }
  } catch(e){ msg.innerText = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'; }
  return false;
}
function clearPasswordForm(){ el('passwordForm').reset(); el('passwordMsg').innerText=''; }

async function toggleVK(){
  try {
    // flip current state
    const now = !!(currentUser && currentUser.linkedVK);
    const res = await fetch('/api/profile/update', { method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include', body: JSON.stringify({ linkedVK: !now })});
    if (!res.ok) { const j = await res.json().catch(()=>({})); el('linkMsg').innerText = j.error || '–û—à–∏–±–∫–∞'; return; }
    const j = await res.json();
    if (j.user) { currentUser = j.user; applyProfile(j.user); el('linkMsg').innerText = !now ? 'VK –ø—Ä–∏–≤—è–∑–∞–Ω' : 'VK –æ—Ç–≤—è–∑–∞–Ω'; }
  } catch(e){ el('linkMsg').innerText = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'; }
}

async function toggleTelegram(){
  try {
    const now = !!(currentUser && currentUser.linkedTelegram);
    const res = await fetch('/api/profile/update', { method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include', body: JSON.stringify({ linkedTelegram: !now })});
    if (!res.ok) { const j = await res.json().catch(()=>({})); el('linkMsg').innerText = j.error || '–û—à–∏–±–∫–∞'; return; }
    const j = await res.json();
    if (j.user) { currentUser = j.user; applyProfile(j.user); el('linkMsg').innerText = !now ? 'Telegram –ø—Ä–∏–≤—è–∑–∞–Ω' : 'Telegram –æ—Ç–≤—è–∑–∞–Ω'; }
  } catch(e){ el('linkMsg').innerText = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'; }
}

/* ============================
   Admin: list users
   ============================ */
async function loadAdminUsers(){
  try {
    const res = await fetch('/api/admin/users', { credentials:'include' });
    if (!res.ok) { el('adminUsersList').textContent = '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∏–ª–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'; return; }
    const j = await res.json();
    if (j.ok && Array.isArray(j.users)) {
      const listEl = el('adminUsersList');
      listEl.innerHTML = '';
      j.users.forEach(u=>{
        const row = document.createElement('div');
        row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center'; row.style.padding='6px 0';
        row.innerHTML = `<div><strong>${escapeHtml(u.fio||u.email||u.phone||u.id)}</strong> <span class="muted">(${escapeHtml(u.email||'')})</span></div>
                         <div><button class="edit-btn" data-del="${u.id}">–£–¥–∞–ª–∏—Ç—å</button></div>`;
        listEl.appendChild(row);
      });
      listEl.querySelectorAll('[data-del]').forEach(btn=>{
        btn.addEventListener('click', async ()=>{
          if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) return;
          const id = btn.getAttribute('data-del');
          const r = await fetch('/api/admin/users/' + encodeURIComponent(id), { method:'DELETE', credentials:'include' });
          if (r.ok) btn.closest('div').remove();
          else alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
        });
      });
    }
  } catch(e){ console.warn('loadAdminUsers fail', e); el('adminUsersList').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏'; }
}

/* ============================
   Logout
   ============================ */
async function logout(){
  try { await fetch('/api/logout', { method:'POST', credentials:'include' }); } catch(e){}
  // redirect to main or auth
  window.location.href = '/';
}

/* ============================
   Init
   ============================ */
document.addEventListener('DOMContentLoaded', async ()=>{
  renderProducts();
  await loadProfile();
  // ensure cart loaded after profile
  // loadCart called from applyProfile
  // bind dismiss
  el('dismissPassportNotice').addEventListener('click', ()=> el('dismissPassportNotice').closest('.notice').style.display='none');
  el('subscribeTelegramBtn').addEventListener('click', ()=> { if (!currentUser) { alert('–ß—Ç–æ–±—ã –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è ‚Äî –≤–æ–π–¥–∏—Ç–µ'); window.location.href='/auth.html'; return; } alert('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ Telegram (—Å–∏–º—É–ª—è—Ü–∏—è).'); });
  // expose adding for shop pages
  window.addToCartBackend = addToCartBackend;
});
</script>
</body>
</html>
