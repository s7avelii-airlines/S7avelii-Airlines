<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>S7avelii | Профиль</title>
<link rel="icon" href="images/favicon.png" type="image/png">

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --accent:#9cc42f; /* main green like on screenshot */
    --accent-2:#b6ce00;
    --muted:#8b97a6;
    --bg:#f5f7fa;
    --card:#ffffff;
    --radius:12px;
    --line: #e6e6e6;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;
    background:var(--bg);
    color:#1f2937;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* Header */
  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 28px;
    height:80px;
    border-bottom:1px solid var(--line);
    position:fixed;top:0;left:0;width:100%;background:var(--card);z-index:1200;
    box-sizing:border-box;
  }
  .brand{display:flex;align-items:center;gap:14px}
  .logo-circle{
    width:46px;height:46px;border-radius:50%;
    background:linear-gradient(135deg,var(--accent-2),#9cc42f);
    display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;
  }
  .brand h1{font-size:18px;margin:0}
  #userArea{min-width:160px;display:flex;align-items:center;justify-content:flex-end;gap:12px}
  #userArea img{width:36px;height:36px;border-radius:50%;object-fit:cover;border:2px solid #fff;box-shadow:0 3px 8px rgba(0,0,0,0.08)}

  /* Page container */
  .container{max-width:1180px;margin:120px auto;padding:0 20px}

  /* Top profile block */
  .profile-top{
    display:flex;gap:26px;align-items:flex-start;background:var(--card);
    padding:26px;border-radius:var(--radius);box-shadow:0 10px 30px rgba(16,24,40,0.06);border:1px solid var(--line);flex-wrap:wrap;
  }
  .avatar-wrap{position:relative;flex-shrink:0}
  #avatar{width:118px;height:118px;border-radius:50%;object-fit:cover;border:6px solid #fff;box-shadow:0 8px 26px rgba(12,20,24,0.06);cursor:pointer}
  .avatar-edit{position:absolute;right:2px;bottom:2px;background:#fff;border-radius:50%;padding:6px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  .profile-info{flex:1}
  .profile-info h2{margin:0;font-size:22px;font-weight:700}
  .profile-sub{color:var(--accent-2);font-weight:600;margin-top:6px;font-size:14px;display:flex;align-items:center;gap:8px}

  .badges{display:flex;align-items:center;gap:8px;margin-top:12px}
  .badge{display:flex;align-items:center;gap:8px;padding:8px;border-radius:20px;background:#fff;border:1px solid #f1f3f4;box-shadow:0 2px 8px rgba(0,0,0,0.03)}
  .badge .dot{width:28px;height:28px;border-radius:50%;background:var(--accent-weak, rgba(180,211,51,0.08));display:flex;align-items:center;justify-content:center;color:var(--accent-2);font-weight:700}

  .counters{display:flex;gap:28px;margin-left:24px;align-items:center}
  .counter{min-width:100px;text-align:center;padding:10px 0;border-left:1px solid #f1f4f6}
  .counter:first-child{border-left:0}
  .counter .num{font-weight:700;font-size:20px}
  .counter .label{color:var(--muted);font-size:13px;margin-top:6px}

  /* Tabs */
  .tabs-wrap{margin-top:18px;border-top:0;padding-top:18px}
  .tabs{display:flex;gap:12px;align-items:center;flex-wrap:wrap;border-bottom:1px solid #eef2f4;padding-bottom:6px}
  .tabs a{padding:10px 14px;text-decoration:none;color:#495057;border-radius:8px;cursor:pointer;font-weight:600}
  .tabs a.active{color:var(--accent-2);background:rgba(156,196,47,0.06);box-shadow: inset 0 -2px 0 rgba(0,0,0,0.00)}

  /* Telegram notification block — made to match screenshot */
  .telegram-block {
    position:relative;
    background:var(--card);
    border-radius:12px;
    box-shadow:0 6px 18px rgba(16,24,40,0.03);
    display:flex;
    align-items:flex-start;
    gap:14px;
    padding:16px 18px;
    width:100%;
    margin-top:16px;
    border:1px solid #eef2f4;
  }
  .telegram-icon{flex-shrink:0;margin-top:4px}
  .telegram-content{flex:1}
  .telegram-title{font-weight:700;font-size:15px;color:#111;margin-bottom:6px}
  .telegram-text{color:#445;line-height:1.4;font-size:14px}
  .telegram-button{margin-top:10px;background:#f6f8fa;border:1px solid #dfe6eb;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
  .telegram-close{position:absolute;right:12px;top:10px;background:none;border:0;font-size:18px;color:#6b7280;cursor:pointer}

  /* Grid with sidebar */
  .grid{display:grid;grid-template-columns:1fr 380px;gap:22px;margin-top:18px}
  .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(16,24,40,0.02);border:1px solid var(--line)}
  .field{display:flex;justify-content:space-between;padding:12px 0;border-top:1px solid rgba(0,0,0,0.03)}
  .small-muted{color:var(--muted);font-size:13px}
  .btn{background:var(--accent-2);color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
  .btn.secondary{background:#eef2f7;color:#111}
  .btn.red{background:#e66}
  .progress-wrap{width:100%;margin-top:8px}
  .progress-bg{width:100%;height:14px;background:#eee;border-radius:999px;overflow:hidden}
  .progress-fill{height:100%;width:0%;background:var(--accent-2);transition:width .6s ease}
  .cart-table{width:100%;border-collapse:collapse}
  .cart-table th,.cart-table td{padding:8px;border-bottom:1px solid #eee;text-align:left}
  .muted{color:var(--muted)}
  .input-inline{width:70%;padding:6px;border-radius:6px;border:1px solid #d6d8db}

  /* product grid small adapt */
  .product-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}

  /* footer */
  footer.footer{margin-top:26px;}

  /* responsive */
  @media(max-width:980px){.grid{grid-template-columns:1fr}.counters{margin-left:0;margin-top:12px;flex-wrap:wrap}}
  @media(max-width:680px){
    .profile-top{padding:18px}
    #avatar{width:90px;height:90px}
    .profile-info h2{font-size:18px}
    .tabs{overflow:auto}
  }
</style>
</head>
<body>

<!-- HEADER -->
<header role="banner">
  <div class="brand" style="align-items:center">
    <div class="logo-circle">S7</div>
    <div>
      <h1 style="margin:0;font-size:16px">S7avelii</h1>
      <div style="font-size:12px;color:var(--muted)">Личный кабинет</div>
    </div>
  </div>

  <div id="userArea"><a href="auth.html">Вход</a></div>
</header>

<!-- PAGE -->
<main class="container" role="main">

  <!-- PROFILE TOP -->
  <div class="profile-top" role="region" aria-label="Профиль верх">
    <div style="display:flex;align-items:center;gap:16px">
      <label for="avatarInput" title="Нажмите чтобы загрузить фото">
        <img id="avatar" class="avatar" src="https://via.placeholder.com/150" alt="avatar">
      </label>
      <input id="avatarInput" type="file" accept="image/*" style="display:none">
      <div class="profile-info">
        <h2 id="fioHeader">Загрузка...</h2>
        <div class="profile-sub" id="phoneHeader">—</div>

        <div style="display:flex;align-items:center;gap:18px;margin-top:12px">
          <div class="badges" aria-hidden="true">
            <div class="badge"><div class="dot" style="background:rgba(156,196,47,0.12);color:var(--accent-2)">T</div><div class="small-muted">Тип</div></div>
            <div class="badge"><div class="dot" style="background:rgba(156,196,47,0.12);color:var(--accent-2)">+</div><div class="small-muted">Плюс</div></div>
          </div>

          <div class="counters" aria-hidden="true">
            <div class="counter"><div class="num" id="bonusMiles">—</div><div class="label">бонусных миль</div></div>
            <div class="counter"><div class="num" id="milesBonusStat">—</div><div class="label">статусная миля</div></div>
            <div class="counter"><div class="num" id="milesStatusStat">—</div><div class="label">статусных полётов</div></div>
          </div>
        </div>

        <div class="tabs-wrap">
          <div class="tabs" role="tablist" aria-label="Вкладки">
            <a class="active" data-tab="profileTab" onclick="showTab(event)">Профиль</a>
            <a data-tab="milesTab" onclick="showTab(event)">Мои мили</a>
            <a data-tab="shopTab" onclick="showTab(event)">S7avelii Shop</a>
            <a data-tab="settingsTab" onclick="showTab(event)">Настройки</a>
          </div>
        </div>
      </div>
    </div>

    <div style="margin-left:auto;min-width:200px;text-align:right">
      <div class="small-muted">Бонусные мили</div>
      <div style="font-weight:700;font-size:20px" id="bonusMiles">—</div>
      <div class="progress-wrap" style="margin-top:10px">
        <div class="progress-bg" aria-hidden="true"><div id="milesProgressBar" class="progress-fill" style="width:0%"></div></div>
        <div style="display:flex;justify-content:space-between;font-size:12px;color:#777;margin-top:6px">
          <div id="milesLabelLeft">0 миль</div>
          <div id="milesLabelRight">—</div>
        </div>
      </div>
    </div>
  </div>

  <!-- TELEGRAM BLOCK (exact like on screenshot) -->
  <div class="telegram-block" role="region" aria-label="Telegram уведомление">
    <div class="telegram-icon" aria-hidden="true">
      <!-- Telegram-like paper plane inside circle (visual only) -->
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="12" fill="#eaf3ff"/>
        <path d="M4 12L20 4L14 20L11 13L4 12Z" fill="#2b7de9"/>
      </svg>
    </div>
    <div class="telegram-content">
      <div class="telegram-title">Уведомления в Телеграме</div>
      <div class="telegram-text">Получайте важную информацию о полёте прямо в мессенджере. Полезно, если вдруг пропустите письмо или пуш.</div>
      <div><button class="telegram-button" onclick="alert('Подписка (демо)')">Подписаться</button></div>
    </div>
    <button class="telegram-close" aria-label="Закрыть уведомление" onclick="this.parentElement.style.display='none'">×</button>
  </div>

  <!-- MAIN GRID -->
  <div class="grid">
    <div>
      <!-- PROFILE TAB -->
      <section id="profileTab" class="card" aria-label="profile" style="display:block">
        <h3>Персональные данные</h3>

        <div class="field">
          <div><div class="small-muted">ФИО</div><div id="fioField">—</div></div>
          <button class="btn" onclick="editInline('fio')">Изменить</button>
        </div>

        <div class="field">
          <div><div class="small-muted">Дата рождения</div><div id="dobField">—</div></div>
          <button class="btn" onclick="editInline('dob')">Изменить</button>
        </div>

        <div class="field">
          <div><div class="small-muted">Пол</div><div id="genderField">—</div></div>
          <button class="btn" onclick="editInline('gender')">Изменить</button>
        </div>

        <h3 style="margin-top:16px">Контакты</h3>

        <div class="field">
          <div><div class="small-muted">E-mail</div><div id="emailField">—</div></div>
          <button class="btn" onclick="editInline('email')">Изменить</button>
        </div>

        <div class="field">
          <div><div class="small-muted">Телефон</div><div id="phoneField">—</div></div>
          <button class="btn" onclick="editInline('phone')">Изменить</button>
        </div>

        <h3 style="margin-top:16px">Карта</h3>

        <div class="field">
          <div><div class="small-muted">Номер карты</div><div id="card_field">—</div></div>
          <button class="btn" onclick="editInline('card_number')">Изменить</button>
        </div>

        <div class="field">
          <div><div class="small-muted">Тип карты</div><div id="cardTypeField">—</div></div>
        </div>
      </section>

      <!-- MILES TAB -->
      <section id="milesTab" class="card" style="margin-top:16px;display:none">
        <h3>Мои мили</h3>
        <div class="muted">Состояние бонусов и прогресс статуса</div>
        <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
          <div class="card" style="flex:1;min-width:200px">
            <div class="small-muted">Бонусные мили</div>
            <div style="font-weight:700;font-size:20px" id="milesBonusStat">—</div>
          </div>
          <div class="card" style="flex:1;min-width:200px">
            <div class="small-muted">Статусные мили</div>
            <div style="font-weight:700;font-size:20px" id="milesStatusStat">—</div>
          </div>
        </div>

        <div style="margin-top:14px">
          <div class="small-muted">Прогресс до следующего уровня</div>
          <div class="progress-bg" style="margin-top:8px"><div id="milesProgressBar2" class="progress-fill" style="width:0%"></div></div>
          <div style="display:flex;justify-content:space-between;font-size:13px;color:#666;margin-top:6px">
            <div id="nextLevelLeft">0 / 0</div>
            <div id="nextLevelRight">—</div>
          </div>
        </div>
      </section>

      <!-- SHOP TAB -->
      <section id="shopTab" class="card" style="margin-top:16px;display:none">
        <h3>S7avelii Shop</h3>
        <div class="muted">Товары, доступные к покупке</div>
        <div id="productGrid" class="product-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-top:12px"></div>
      </section>

      <!-- SETTINGS -->
      <section id="settingsTab" class="card" style="margin-top:16px;display:none">
        <h3>Настройки</h3>
        <button class="btn red" onclick="logout()">Выйти</button>
      </section>
    </div>

    <!-- SIDEBAR -->
    <aside>
      <section class="card">
        <h3>Корзина</h3>
        <table class="cart-table" id="cartTable" aria-label="Корзина">
          <thead><tr><th>Товар</th><th>Цена</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
        <div style="margin-top:12px;display:flex;justify-content:space-between;font-weight:600">
          <span>Итого:</span>
          <span id="cartTotal">0 ₽</span>
        </div>
        <button class="btn" style="width:100%;margin-top:12px" onclick="checkout()">Оформить</button>
      </section>
    </aside>
  </div>

  <footer class="footer" style="margin-top:24px">
    <div style="text-align:center;color:var(--muted);padding:24px 0">© 2025 S7avelii — Все права защищены</div>
  </footer>

</main>

<!-- ====== SCRIPTS (твоя логика — не трогал) ====== -->
<script>
/*
  Final cabinet.js integrated in this file.
  - Autologin via localStorage token
  - Inline editing (input/select/date) with onchange -> PUT /api/profile
  - Avatar upload -> POST /api/profile/avatar (multipart)
  - Shop / cart and checkout
  - userArea (avatar or name) in header
*/

const API = "https://s7avelii-airlines-1.onrender.com"; // <- заменяй, если у тебя другой бекенд
function getToken(){ return localStorage.getItem('token'); }

let currentUser = null;
let products = [];
let cart = [];

// apiFetch reads token dynamically
async function apiFetch(endpoint, options = {}) {
  const token = getToken();
  options.headers = { ...(options.headers || {}) };
  if (token) options.headers['Authorization'] = 'Bearer ' + token;
  // do not set Content-Type for FormData
  if (options.body && !(options.body instanceof FormData) && typeof options.body !== 'string') {
    options.headers['Content-Type'] = 'application/json';
    options.body = JSON.stringify(options.body);
  }
  const res = await fetch(API + endpoint, options).catch(e => { console.error('fetch err', e); return null; });
  if (!res) return null;
  if (res.status === 401) { logout(); return null; }
  const json = await res.json().catch(()=> ({}));
  return json;
}

// Update header user area (avatar or name)
async function updateUserArea() {
  const userArea = document.getElementById('userArea');
  const token = getToken();
  if (!token) {
    userArea.innerHTML = `<a href="auth.html">Вход</a>`;
    return;
  }
  try {
    const user = await apiFetch('/api/profile');
    if (!user || !user.fio) { userArea.innerHTML = `<a href="auth.html">Вход</a>`; return; }
    currentUser = user;
    // avatar path from server usually like /avatars/xxx
    if (user.avatar) {
      const avatarUrl = (user.avatar.startsWith('http') ? user.avatar : API + user.avatar);
      userArea.innerHTML = `<img src="${avatarUrl}" alt="avatar" style="width:36px;height:36px;border-radius:50%;cursor:pointer;object-fit:cover" onclick="window.location.href='cabinet.html'">`;
      document.getElementById('avatar').src = avatarUrl;
    } else {
      const short = (user.fio && user.fio.split(' ')[0]) || user.email || 'Профиль';
      userArea.innerHTML = `<span style="cursor:pointer;color:#2196f3;font-weight:500;" onclick="window.location.href='cabinet.html'">${escapeHtml(short)}</span>`;
    }
    loadProfile(); // render details
  } catch (e) {
    console.error('updateUserArea err', e);
    userArea.innerHTML = `<a href="auth.html">Вход</a>`;
  }
}

// simple escape
function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

// Tabs
function showTab(evt){
  const tab = evt.currentTarget.dataset.tab;
  document.querySelectorAll('.tabs a').forEach(a=>a.classList.remove('active'));
  evt.currentTarget.classList.add('active');
  document.querySelectorAll('.grid section').forEach(s=>s.style.display='none');
  document.getElementById(tab).style.display = 'block';
}

// Render profile fields
function loadProfile(){
  if(!currentUser) return;
  document.getElementById('fioHeader').textContent = currentUser.fio || '—';
  document.getElementById('phoneHeader').textContent = currentUser.phone || '—';
  document.getElementById('fioField').textContent = currentUser.fio || '—';
  document.getElementById('dobField').textContent = currentUser.dob || '—';
  document.getElementById('genderField').textContent = currentUser.gender || '—';
  document.getElementById('emailField').textContent = currentUser.email || '—';
  document.getElementById('phoneField').textContent = currentUser.phone || '—';
  document.getElementById('card_field').textContent = currentUser.card_number || '—';
  document.getElementById('cardTypeField').textContent = currentUser.card_type || '—';

  document.getElementById('bonusMiles').textContent = currentUser.bonus_miles || 0;
  const perc = Math.min(100, (currentUser.bonus_miles || 0) / 1000 * 100);
  document.getElementById('milesProgressBar').style.width = perc + '%';
  document.getElementById('milesLabelRight').textContent = (currentUser.bonus_miles || 0) + ' миль';
  document.getElementById('milesBonusStat').textContent = currentUser.bonus_miles || 0;
  document.getElementById('milesStatusStat').textContent = currentUser.status_miles || 0;
  document.getElementById('milesProgressBar2').style.width = Math.min(100, (currentUser.status_miles || 0) / 1000 * 100) + '%';
  document.getElementById('nextLevelLeft').textContent = (currentUser.status_miles || 0) + '/1000';
}

// Inline editing: creates input/select/date, sends PUT /api/profile on change
async function editInline(field) {
  if(!currentUser) return;
  // map DOM ids and server field names
  const domMap = {
    fio: 'fioField',
    dob: 'dobField',
    gender: 'genderField',
    email: 'emailField',
    phone: 'phoneField',
    card_number: 'card_field'
  };
  const domId = domMap[field] || field + 'Field';
  const container = document.getElementById(domId);
  if(!container) return;

  // current value
  const cur = (field === 'card_number' ? currentUser.card_number : currentUser[field]) || '';

  // create input element depending on field
  let input;
  if (field === 'dob') {
    input = document.createElement('input');
    input.type = 'date';
    input.value = cur;
  } else if (field === 'gender') {
    input = document.createElement('select');
    ['','Мужской','Женский','Другое'].forEach(val=>{
      const o = document.createElement('option'); o.value = val; o.textContent = val || 'Не указан';
      if(val === cur) o.selected = true;
      input.appendChild(o);
    });
  } else if (field === 'phone') {
    input = document.createElement('input'); input.type = 'tel'; input.value = cur;
  } else {
    input = document.createElement('input'); input.type = 'text'; input.value = cur;
  }

  input.className = 'input-inline';
  // Save on change or on blur
  let saved = false;
  input.addEventListener('change', async () => {
    await saveField(field, input.value);
    saved = true;
  });
  input.addEventListener('blur', async () => {
    if(!saved) await saveField(field, input.value);
  });

  // replace content
  container.innerHTML = '';
  container.appendChild(input);
  input.focus();
}

// Save single field to server
async function saveField(field, value) {
  const payload = {};
  // server columns: fio, dob, gender, email, phone, card_number, card_type
  payload[field] = value;
  const res = await apiFetch('/api/profile', { method: 'PUT', body: payload });
  if (res && res.ok) {
    // refresh user data
    const updated = await apiFetch('/api/profile');
    if (updated) { currentUser = updated; loadProfile(); updateUserArea(); }
  } else {
    alert('Ошибка при сохранении');
    // reload profile to original
    const re = await apiFetch('/api/profile'); if(re){ currentUser = re; loadProfile(); }
  }
}

// Avatar upload
document.getElementById('avatarInput').addEventListener('change', async function(){
  if(!this.files[0]) return;
  const fd = new FormData();
  fd.append('avatar', this.files[0]);
  const token = getToken();
  try{
    const res = await fetch(API + '/api/profile/avatar', {
      method: 'POST',
      headers: token ? { 'Authorization': 'Bearer ' + token } : {},
      body: fd
    });
    const data = await res.json();
    if (data && data.avatar) {
      const avatarUrl = data.avatar.startsWith('http') ? data.avatar : API + data.avatar;
      document.getElementById('avatar').src = avatarUrl;
      await updateUserArea();
    } else {
      alert('Ошибка загрузки аватара');
    }
  }catch(err){ console.error('avatar upload', err); alert('Ошибка сети при загрузке'); }
});

// Shop & cart
async function loadShop(){
  const data = await apiFetch('/api/shop');
  products = (data && data.products) ? data.products : [];
  renderProducts();
}

function renderProducts(){
  const grid = document.getElementById('productGrid');
  grid.innerHTML = '';
  products.forEach(p=>{
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `<div style="font-weight:600">${escapeHtml(p.name)}</div>
                     <div class="small-muted">${p.price} ₽</div>
                     <button class="btn" onclick="addToCart(${p.id})">В корзину</button>`;
    grid.appendChild(div);
  });
}

function addToCart(id){
  const p = products.find(x=>x.id===id);
  if(!p) return;
  cart.push(p);
  renderCart();
}

function removeFromCart(i){
  cart.splice(i,1);
  renderCart();
}

function renderCart(){
  const tbody = document.getElementById('cartTable').querySelector('tbody');
  tbody.innerHTML = '';
  let total = 0;
  cart.forEach((p,i)=>{
    total += p.price;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${escapeHtml(p.name)}</td><td>${p.price} ₽</td><td><button class="btn secondary" onclick="removeFromCart(${i})">×</button></td>`;
    tbody.appendChild(tr);
  });
  document.getElementById('cartTotal').textContent = total + ' ₽';
}

async function checkout(){
  if(cart.length === 0) { alert('Корзина пуста'); return; }
  const res = await apiFetch('/api/checkout', { method: 'POST', body: { items: cart } });
  if(res && res.ok) { cart = []; renderCart(); alert('Заказ оформлен!'); }
  else alert('Ошибка при оформлении заказа');
}

// Logout
function logout(){
  localStorage.removeItem('token');
  window.location.href = 'auth.html';
}

// init
window.addEventListener('DOMContentLoaded', async () => {
  const token = getToken();
  if(!token){ window.location.href = 'auth.html'; return; }
  await updateUserArea();
  await loadShop();
});

// helper: escape HTML for text nodes
function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
</script>

</body>
</html>
