<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#f4f6f8; }
    header { background:#2196f3; padding:15px; color:#fff; display:flex; justify-content:space-between; align-items:center; }
    header h1 { margin:0; font-size:20px; }
    header button { background:#fff; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; font-weight:bold; }

    main { padding:20px; display:grid; grid-template-columns: 1fr 1fr; gap:20px; }
    section { background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }

    h2 { margin-top:0; font-size:18px; }

    .profile-item { margin:6px 0; }
    input { width:100%; padding:8px; margin:6px 0; border:1px solid #ccc; border-radius:6px; }

    .progress-bar { background:#ddd; border-radius:8px; overflow:hidden; height:20px; margin-top:10px; }
    .progress { background:#4caf50; height:100%; width:0%; text-align:center; color:#fff; font-size:12px; }

    .cart-item { display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px solid #eee; }
    .cart-item:last-child { border:none; }

    button.action { background:#2196f3; color:#fff; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; margin-top:8px; }
    button.action:hover { background:#1976d2; }
  </style>
</head>
<body>
  <header>
    <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
    <button id="logoutBtn">–í—ã–π—Ç–∏</button>
  </header>

  <main>
    <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
    <section>
      <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
      <div id="profileView">
        <div class="profile-item"><b>–§–ò–û:</b> <span id="fio"></span></div>
        <div class="profile-item"><b>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</b> <span id="dob"></span></div>
        <div class="profile-item"><b>–ü–æ–ª:</b> <span id="gender"></span></div>
        <div class="profile-item"><b>Email:</b> <span id="email"></span></div>
        <div class="profile-item"><b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> <span id="phone"></span></div>
        <div class="profile-item"><b>–ö–∞—Ä—Ç–∞:</b> <span id="card"></span></div>
      </div>
    </section>

  <div style="max-width:600px; margin:20px auto; font-family:Arial, sans-serif; color:#333;">
  <div style="background:#fff; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); padding:20px;">
    
    <h2 style="font-size:18px; font-weight:600; margin-bottom:10px;">
      –°—Ç–∞—Ç—É—Å –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ <a href="#" style="color:#1a73e8; text-decoration:none;">S7 Priority</a>
    </h2>

    <div style="margin-bottom:20px;">
      <div style="font-size:14px; color:#666;">–í–∞—à —Å—Ç–∞—Ç—É—Å:</div>
      <div id="statusName" style="font-size:20px; font-weight:bold;">Classic</div>
    </div>

    <div style="background:#f9fafb; border-radius:10px; padding:15px; margin-bottom:20px;">
      <div style="font-size:24px; font-weight:bold; margin-bottom:5px;">
        <span id="milesValue">0</span> –±–æ–Ω—É—Å–Ω—ã–µ –º–∏–ª–∏
      </div>
    </div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
    <div style="margin-bottom:10px; font-size:14px;">
      <span id="currentMiles" style="background:#8bc34a; color:#fff; border-radius:8px; padding:2px 8px; font-weight:bold;">0 –º–∏–ª—å</span>
      <span style="margin-left:10px; color:#666;">0 –ø–æ–ª—ë—Ç–æ–≤</span>
    </div>

    <div style="background:#e9ecef; border-radius:6px; height:12px; width:100%; overflow:hidden;">
      <div id="milesProgress" style="background:#8bc34a; height:100%; width:0%;"></div>
    </div>

    <div style="display:flex; justify-content:space-between; margin-top:5px; font-size:12px; color:#999;">
      <span id="nextLevelName">Classic Master</span>
      <span id="nextLevelMiles">5000</span>
    </div>

    <div style="margin-top:15px; font-size:14px; color:#666;">
      –°—Ç–∞—Ç—É—Å–Ω—ã—Ö –º–∏–ª—å: <b id="statusMiles">0</b><br>
      –ü–æ–ª—ë—Ç–æ–≤: <b id="flights">0</b>
    </div>

    <!-- –ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏ -->
    <div style="margin-top:20px;">
      <h3 style="font-size:15px; margin-bottom:10px; color:#444;">–ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏ —Å—Ç–∞—Ç—É—Å–∞:</h3>
      <ul id="privileges" style="list-style:none; padding-left:15px; color:#333;">
        <!-- —Å—é–¥–∞ –≤—Å—Ç–∞–≤–∏–º –ø—É–Ω–∫—Ç—ã -->
      </ul>
    </div>

    <hr style="margin:15px 0; border:0; border-top:1px solid #eee;">

    <div style="font-size:14px; color:#444; display:flex; justify-content:space-between; align-items:center;">
      <div>
        –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: <b id="registrationDate"></b>
      </div>
      <div>
        –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å—á—ë—Ç–∞: <b style="color:#2e7d32;" id="accountStatus">–ê–∫—Ç–∏–≤–Ω—ã–π</b>
      </div>
    </div>

  </div>
</div>

<script>
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤
  const statuses = {
    Classic: {
      name: "Classic",
      nextLevel: "Classic Master",
      maxMiles: 5000,
      color: "#8bc34a",
      privileges: [
        "–ë–æ–Ω—É—Å–Ω—ã–µ –º–∏–ª–∏ –∫–æ–ø—è—Ç—Å—è –∑–∞ –ø–æ–∫—É–ø–∫–∏ –Ω–∞ —Å–∞–π—Ç–µ –∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ú–æ–∂–Ω–æ —Ç—Ä–∞—Ç–∏—Ç—å –Ω–∞ –∞–≤–∏–∞–±–∏–ª–µ—Ç—ã –∏ –¥–æ–ø—É—Å–ª—É–≥–∏.",
        "–°—Ç–∞—Ç—É—Å–Ω—ã–µ –º–∏–ª–∏ –∫–æ–ø—è—Ç—Å—è –∑–∞ –ø–æ–ª–µ—Ç—ã –∏ –ø–æ–∫—É–ø–∫–∏ –ø–æ –∫–∞—Ä—Ç–µ S7 ‚Äî T-Bank."
      ]
    },
    VIP: {
      name: "VIP",
      nextLevel: "VIP Gold",
      maxMiles: 25000,
      color: "#fbc02d",
      privileges: [
        "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ—Å–∞–¥–∫–∞.",
        "–î–æ—Å—Ç—É–ø –≤ –±–∏–∑–Ω–µ—Å-–∑–∞–ª—ã –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤.",
        "–ë–æ–Ω—É—Å–Ω—ã–µ –∏ —Å—Ç–∞—Ç—É—Å–Ω—ã–µ –º–∏–ª–∏ –∑–∞ –ø–æ–ª—ë—Ç—ã –∏ –ø–æ–∫—É–ø–∫–∏."
      ]
    }
  };

  function updateStatus(type, miles, flights=0, registration="06 –∏—é–ª 2021", account="–ê–∫—Ç–∏–≤–Ω—ã–π") {
    const s = statuses[type];
    const percent = Math.min(100, (miles / s.maxMiles) * 100);

    document.getElementById("statusName").textContent = s.name;
    document.getElementById("milesValue").textContent = miles;
    document.getElementById("statusMiles").textContent = miles;
    document.getElementById("flights").textContent = flights;
    document.getElementById("currentMiles").textContent = miles + " –º–∏–ª—å";
    document.getElementById("nextLevelName").textContent = s.nextLevel;
    document.getElementById("nextLevelMiles").textContent = s.maxMiles;

    const progress = document.getElementById("milesProgress");
    progress.style.width = percent + "%";
    progress.style.background = s.color;
    document.getElementById("currentMiles").style.background = s.color;

    // –ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏
    const list = document.getElementById("privileges");
    list.innerHTML = "";
    s.privileges.forEach(p => {
      const li = document.createElement("li");
      li.innerHTML = "‚Ä¢ " + p;
      li.style.marginBottom = "5px";
      list.appendChild(li);
    });

    // –î–∞—Ç–∞ –∏ —Å—Ç–∞—Ç—É—Å
    document.getElementById("registrationDate").textContent = registration;
    document.getElementById("accountStatus").textContent = account;
  }

  // üîπ –¢–µ—Å—Ç: Classic
  updateStatus("Classic", 1057, 0, "06 –∏—é–ª 2021", "–ê–∫—Ç–∏–≤–Ω—ã–π");

  // üîπ –ü—Ä–∏–º–µ—Ä VIP:
  // updateStatus("VIP", 12340, 5, "15 –º–∞—Ä 2022", "–ê–∫—Ç–∏–≤–Ω—ã–π");
</script>


    <!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
    <section>
      <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
      <div id="cart"></div>
      <button id="checkoutBtn" class="action">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </section>

    <!-- –ó–∞–∫–∞–∑—ã -->
    <section>
      <h2>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
      <ul id="orders"></ul>
    </section>
  </main>

  <script>
    async function loadProfile() {
      const res = await fetch('/api/profile', { credentials:'include' });
      if (!res.ok) { window.location.href = '/auth.html'; return; }
      const user = await res.json();

      document.getElementById('fio').textContent = user.fio;
      document.getElementById('dob').textContent = user.dob || '-';
      document.getElementById('gender').textContent = user.gender || '-';
      document.getElementById('email').textContent = user.email;
      document.getElementById('phone').textContent = user.phone;
      document.getElementById('card').textContent = user.cardNumber || '-' + " " + (user.cardType||'');

      document.getElementById('miles').textContent = user.miles;
      updateMilesProgress(user.miles);

      renderCart(user.cart || []);
      renderOrders(user.orders || []);
    }

    function updateMilesProgress(miles) {
      const progress = document.getElementById('milesProgress');
      const percent = Math.min(100, Math.floor((miles % 1000) / 10));
      progress.style.width = percent + '%';
      progress.textContent = percent + '%';
    }

    function renderCart(cart) {
      const cartDiv = document.getElementById('cart');
      cartDiv.innerHTML = '';
      if (!cart.length) { cartDiv.textContent = '–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'; return; }
      cart.forEach(item => {
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `<span>${item.name} (x${item.qty})</span><span>${item.price}‚ÇΩ</span>`;
        cartDiv.appendChild(div);
      });
    }

    function renderOrders(orders) {
      const ordersUl = document.getElementById('orders');
      ordersUl.innerHTML = '';
      if (!orders.length) { ordersUl.innerHTML = '<li>–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</li>'; return; }
      orders.forEach(o => {
        const li = document.createElement('li');
        li.textContent = `–ó–∞–∫–∞–∑ #${o.id} ‚Äî ${o.items.length} —Ç–æ–≤–∞—Ä–æ–≤, —Å—É–º–º–∞ ${o.total}‚ÇΩ`;
        ordersUl.appendChild(li);
      });
    }

    document.getElementById('checkoutBtn').onclick = async () => {
      const res = await fetch('/api/checkout', {
        method:'POST',
        credentials:'include'
      });
      if (res.ok) {
        alert('–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!');
        loadProfile();
      }
    };

    document.getElementById('logoutBtn').onclick = async () => {
      await fetch('/api/logout', { credentials:'include' });
      window.location.href = '/index.html';
    };

    loadProfile();
  </script>
</body>
</html>
