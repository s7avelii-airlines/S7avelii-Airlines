<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Авторизация</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f8; display:flex; justify-content:center; align-items:center; height:100vh; }
    .container { background:#fff; padding:20px; border-radius:12px; width:360px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
    h2 { text-align:center; margin-bottom:15px; }
    input, select { width:100%; padding:10px; margin:6px 0; border:1px solid #ccc; border-radius:6px; }
    button { width:100%; padding:10px; background:#2196f3; border:none; border-radius:6px; color:#fff; font-weight:bold; cursor:pointer; margin-top:10px; }
    button:hover { background:#1976d2; }
    .toggle { text-align:center; margin-top:10px; cursor:pointer; color:#2196f3; }
    .hidden { display:none; }
    .error { color:red; text-align:center; margin:5px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h2 id="formTitle">Вход</h2>
    <div id="error" class="error"></div>

    <!-- Форма входа -->
    <form id="loginForm">
      <input type="text" id="loginPhone" placeholder="Телефон" required>
      <input type="password" id="loginPassword" placeholder="Пароль" required>
      <button type="submit">Войти</button>
    </form>

    <!-- Форма регистрации -->
    <form id="registerForm" class="hidden">
      <input type="text" id="regFio" placeholder="ФИО" required>
      <input type="date" id="regDob" required>
      <select id="regGender">
        <option value="Мужской">Мужской</option>
        <option value="Женский">Женский</option>
      </select>
      <input type="email" id="regEmail" placeholder="Email" required>
      <input type="text" id="regPhone" placeholder="Телефон" required>
      <input type="password" id="regPassword" placeholder="Пароль" required>
      <input type="text" id="regCardNumber" placeholder="Номер карты (необязательно)">
      <input type="text" id="regCardType" placeholder="Тип карты (Visa, MasterCard...)">
      <button type="submit">Зарегистрироваться</button>
    </form>

    <div class="toggle" id="toggleForm">Нет аккаунта? Зарегистрируйтесь</div>
  </div>

  <script>
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const toggleForm = document.getElementById('toggleForm');
    const formTitle = document.getElementById('formTitle');
    const errorDiv = document.getElementById('error');

    toggleForm.onclick = () => {
      if (loginForm.classList.contains('hidden')) {
        loginForm.classList.remove('hidden');
        registerForm.classList.add('hidden');
        formTitle.textContent = "Вход";
        toggleForm.textContent = "Нет аккаунта? Зарегистрируйтесь";
      } else {
        loginForm.classList.add('hidden');
        registerForm.classList.remove('hidden');
        formTitle.textContent = "Регистрация";
        toggleForm.textContent = "Уже есть аккаунт? Войдите";
      }
      errorDiv.textContent = "";
    };

    loginForm.onsubmit = async e => {
      e.preventDefault();
      const phone = document.getElementById('loginPhone').value.trim();
      const password = document.getElementById('loginPassword').value.trim();

      const res = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ phone, password })
      });

      const data = await res.json();
      if (res.ok) {
        window.location.href = '/cabinet.html';
      } else {
        errorDiv.textContent = data.error || 'Ошибка входа';
      }
    };

    registerForm.onsubmit = async e => {
      e.preventDefault();
      const fio = document.getElementById('regFio').value.trim();
      const dob = document.getElementById('regDob').value;
      const gender = document.getElementById('regGender').value;
      const email = document.getElementById('regEmail').value.trim();
      const phone = document.getElementById('regPhone').value.trim();
      const password = document.getElementById('regPassword').value.trim();
      const cardNumber = document.getElementById('regCardNumber').value.trim();
      const cardType = document.getElementById('regCardType').value.trim();

      const res = await fetch('/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ fio, dob, gender, email, phone, password, cardNumber, cardType })
      });

      const data = await res.json();
      if (res.ok) {
        window.location.href = '/cabinet.html';
      } else {
        errorDiv.textContent = data.error || 'Ошибка регистрации';
      }
    };
  </script>
</body>
</html>

