<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Вход/Регистрация S7avelii</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family: Inter, Arial, sans-serif; background:#f3f4f6; display:flex; justify-content:center; align-items:center; height:100vh; }
.card { background:white; padding:24px; border-radius:12px; width:100%; max-width:400px; box-shadow:0 4px 12px rgba(0,0,0,0.15); }
input { width:100%; padding:10px 12px; margin-top:10px; border-radius:8px; border:1px solid #d6d8db; }
button { width:100%; margin-top:14px; padding:12px; border:none; border-radius:8px; background:#9cc42f; color:white; font-weight:600; cursor:pointer; }
button:hover { background:#8ab12a; }
.hidden { display:none; }
.error { color:red; font-size:13px; margin-top:6px; }
.success { color:green; font-size:13px; margin-top:6px; }
.switch { margin-top:14px; text-align:center; font-size:14px; }
.switch button { background:none; border:none; color:#9cc42f; cursor:pointer; text-decoration:underline; font:inherit; }
</style>
</head>
<body>
<div class="card">
<h2 id="title">Вход</h2>

<form id="loginForm">
<input id="loginIdentifier" type="text" placeholder="Телефон или Email" required>
<input id="loginPassword" type="password" placeholder="Пароль" required>
<button id="loginBtn" type="submit">Войти</button>
<div id="loginError" class="error"></div>
</form>

<form id="registerForm" class="hidden">
<input id="regFio" type="text" placeholder="ФИО" required>
<input id="regEmail" type="email" placeholder="Email" required>
<input id="regPhone" type="tel" placeholder="Телефон" required>
<input id="regPassword" type="password" placeholder="Пароль (мин.6)" required>
<button id="regBtn" type="submit">Зарегистрироваться</button>
<div id="regError" class="error"></div>
<div id="regSuccess" class="success"></div>
</form>

<div class="switch">
<span id="switchText">Нет аккаунта?</span>
<button id="switchBtn">Зарегистрироваться</button>
</div>
</div>

<script>
const API = 'https://s7avelii-airlines-1.onrender.com';

const loginForm = document.getElementById('loginForm');
const registerForm = document.getElementById('registerForm');
const switchBtn = document.getElementById('switchBtn');
const switchText = document.getElementById('switchText');
const title = document.getElementById('title');
const loginError = document.getElementById('loginError');
const regError = document.getElementById('regError');
const regSuccess = document.getElementById('regSuccess');

function showForm(showLogin){
  if(showLogin){
    loginForm.classList.remove('hidden');
    registerForm.classList.add('hidden');
    title.textContent = 'Вход';
    switchText.textContent = 'Нет аккаунта?';
    switchBtn.textContent = 'Зарегистрироваться';
  } else {
    loginForm.classList.add('hidden');
    registerForm.classList.remove('hidden');
    title.textContent = 'Регистрация';
    switchText.textContent = 'Уже есть аккаунт?';
    switchBtn.textContent = 'Войти';
  }
  loginError.textContent = '';
  regError.textContent = '';
  regSuccess.textContent = '';
}

switchBtn.addEventListener('click', e => { e.preventDefault(); showForm(loginForm.classList.contains('hidden')); });

// --- LOGIN ---
loginForm.addEventListener('submit', async e => {
  e.preventDefault();
  loginError.textContent = '';
  const identifier = document.getElementById('loginIdentifier').value.trim();
  const password = document.getElementById('loginPassword').value;
  if(!identifier){ loginError.textContent='Введите телефон или Email.'; return; }
  if(!password){ loginError.textContent='Введите пароль.'; return; }

  try {
    const res = await fetch(`${API}/api/login`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({identifier, password})
    });
    const data = await res.json();
    if(!res.ok){ loginError.textContent=data.error || 'Ошибка входа'; return; }

    localStorage.setItem('token', data.token);
    window.location.href = 'cabinet.html';
  } catch(err){
    console.error(err);
    loginError.textContent = 'Ошибка сети. Проверь сервер и CORS.';
  }
});

// --- REGISTER ---
registerForm.addEventListener('submit', async e => {
  e.preventDefault();
  regError.textContent=''; regSuccess.textContent='';

  const fio = document.getElementById('regFio').value.trim();
  const email = document.getElementById('regEmail').value.trim();
  const phone = document.getElementById('regPhone').value.trim();
  const password = document.getElementById('regPassword').value;

  if(!fio){ regError.textContent='Введите ФИО.'; return; }
  if(!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){ regError.textContent='Введите корректный email.'; return; }
  if(!phone){ regError.textContent='Введите телефон.'; return; }
  if(!password || password.length<6){ regError.textContent='Пароль должен быть не менее 6 символов.'; return; }

  try {
    const res = await fetch(`${API}/api/register`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({fio,email,phone,password})
    });
    const data = await res.json();
    if(!res.ok){ regError.textContent=data.error || 'Ошибка регистрации'; return; }

    localStorage.setItem('token', data.token);
    regSuccess.textContent = 'Регистрация успешна — перенаправляем...';
    setTimeout(()=>window.location.href='cabinet.html', 700);
  } catch(err){
    console.error(err);
    regError.textContent = 'Ошибка сети. Проверь сервер и CORS.';
  }
});
</script>
</body>
</html>

