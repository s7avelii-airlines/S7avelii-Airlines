<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>S7avelii — ID</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/imask"></script>

<style>
:root{
  --green:#9cc42f;
  --green-dark:#8ab12a;
  --bg:#f4f6f8;
  --muted:#6b7280;
}
*{box-sizing:border-box;font-family:'Inter',sans-serif}
body{
  margin:0;
  background:var(--bg);
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  padding:16px;
}
.card{
  width:100%;
  max-width:420px;
  background:#fff;
  border-radius:24px;
  padding:28px;
  box-shadow:0 20px 50px rgba(0,0,0,.12);
}
h1{margin:0 0 10px;font-size:22px}
.subtitle{color:var(--muted);margin-bottom:18px}
.field{margin-bottom:14px}
input{
  width:100%;
  padding:16px;
  border-radius:14px;
  border:1px solid #ddd;
  font-size:15px;
}
input:focus{border-color:var(--green);outline:none}
.btn{
  width:100%;
  padding:16px;
  border:none;
  border-radius:14px;
  font-weight:600;
  cursor:pointer;
}
.btn-primary{background:var(--green);color:#fff}
.btn-primary:hover{background:var(--green-dark)}
.btn-secondary{background:#eef2f7;margin-top:8px}
.switch{
  text-align:center;
  margin-top:14px;
  font-size:14px;
}
.switch button{
  background:none;border:0;color:var(--green);cursor:pointer;
}
.hidden{display:none}
.error{color:#dc2626;font-size:13px;margin-top:6px}
</style>
</head>

<body>

<div class="card">

<!-- LOGIN SCREEN -->
<div id="loginScreen">
  <h1>Вход</h1>
  <div class="subtitle">Телефон</div>

  <div class="field">
    <input id="loginPhone">
  </div>

  <button id="smsBtn" class="btn btn-primary">Получить код</button>
  <button id="showPassBtn" class="btn btn-secondary">Войти по паролю</button>

  <div class="switch">
    Нет аккаунта?
    <button onclick="showRegister()">Зарегистрироваться</button>
  </div>

  <div id="loginError" class="error"></div>
</div>

<!-- PASSWORD LOGIN -->
<div id="passwordScreen" class="hidden">
  <h1>Вход по паролю</h1>

  <div class="field">
    <input id="passPhone">
  </div>

  <div class="field">
    <input id="passInput" type="password" placeholder="Пароль">
  </div>

  <button id="loginPassBtn" class="btn btn-primary">Войти</button>
  <button onclick="showLogin()" class="btn btn-secondary">Назад</button>

  <div id="passError" class="error"></div>
</div>

<!-- CODE SCREEN -->
<div id="codeScreen" class="hidden">
  <h1>Код из SMS</h1>

  <div class="field">
    <input id="codeInput" maxlength="4" inputmode="numeric" style="text-align:center;font-size:20px">
  </div>

  <button id="verifyBtn" class="btn btn-primary">Подтвердить</button>
  <div id="codeError" class="error"></div>
</div>

<!-- REGISTER -->
<div id="registerScreen" class="hidden">
  <h1>Регистрация</h1>

  <div class="field">
    <input id="regFio" placeholder="ФИО">
  </div>

  <div class="field">
    <input id="regPhone">
  </div>

  <div class="field">
    <input id="regBirth" placeholder="Дата рождения">
  </div>

  <div class="field">
    <input id="regPriority" placeholder="Priority">
  </div>

  <div class="field">
    <input id="regPassword" type="password" placeholder="Пароль">
  </div>

  <button id="registerBtn" class="btn btn-primary">Создать аккаунт</button>
  <button onclick="showLogin()" class="btn btn-secondary">Назад</button>

  <div id="regError" class="error"></div>
</div>

</div>

<script>
const API='https://s7avelii-airlines-1.onrender.com';

/* МАСКИ */
IMask(loginPhone,{mask:'+{7} (000) 000-00-00'});
IMask(passPhone,{mask:'+{7} (000) 000-00-00'});
IMask(regPhone,{mask:'+{7} (000) 000-00-00'});
IMask(regBirth,{mask:'00.00.0000'});
IMask(regPriority,{mask:'000 000 000'});

/* ПЕРЕКЛЮЧЕНИЕ */
function showRegister(){
  loginScreen.classList.add('hidden');
  registerScreen.classList.remove('hidden');
}
function showLogin(){
  registerScreen.classList.add('hidden');
  passwordScreen.classList.add('hidden');
  codeScreen.classList.add('hidden');
  loginScreen.classList.remove('hidden');
}

/* SMS LOGIN */
smsBtn.onclick=async()=>{
  const res=await fetch(API+'/api/auth/request-code',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({phone:loginPhone.value})
  });
  if(!res.ok){loginError.textContent='Ошибка';return;}
  loginScreen.classList.add('hidden');
  codeScreen.classList.remove('hidden');
};

/* VERIFY */
verifyBtn.onclick=async()=>{
  const res=await fetch(API+'/api/auth/verify-code',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      phone:loginPhone.value,
      code:codeInput.value
    })
  });
  const data=await res.json();
  if(!res.ok){codeError.textContent=data.error;return;}
  localStorage.setItem('token',data.token);
  location.href='cabinet.html';
};

/* PASSWORD SCREEN */
showPassBtn.onclick=()=>{
  loginScreen.classList.add('hidden');
  passwordScreen.classList.remove('hidden');
};

/* PASSWORD LOGIN */
loginPassBtn.onclick=async()=>{
  const res=await fetch(API+'/api/auth/login',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      phone:passPhone.value,
      password:passInput.value
    })
  });
  const data=await res.json();
  if(!res.ok){passError.textContent=data.error;return;}
  localStorage.setItem('token',data.token);
  location.href='cabinet.html';
};

/* REGISTER */
registerBtn.onclick=async()=>{
  const res=await fetch(API+'/api/auth/register',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      fio:regFio.value,
      phone:regPhone.value,
      birth:regBirth.value,
      priority:regPriority.value,
      password:regPassword.value
    })
  });
  const data=await res.json();
  if(!res.ok){regError.textContent=data.error;return;}
  alert('Аккаунт создан');
  showLogin();
};
</script>

</body>
</html>
