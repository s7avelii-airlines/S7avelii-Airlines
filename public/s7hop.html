<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>S7avelii Shop</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:20px; background:#f5f5f5; }
  .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:20px; }
  .card { background:#fff; border-radius:12px; padding:12px; box-shadow:0 2px 8px rgba(0,0,0,0.1); display:flex; flex-direction:column; }
  .thumb img { width:100%; height:200px; object-fit:contain; border-radius:12px; }
  .title { font-weight:600; margin:8px 0; min-height:40px; }
  .price { font-weight:700; margin-bottom:8px; }
  .btn { padding:8px 12px; border:none; border-radius:8px; cursor:pointer; font-weight:600; margin-top:auto; }
  .btn-buy { background:#4caf50; color:#fff; margin-bottom:6px; }
  .btn-cart { background:#ff9800; color:#fff; }
</style>
</head>
<body>

<h1>S7avelii Shop</h1>
<div class="grid" id="productGrid"></div>

<script>
const products = [
  { id: '1', title:'Блокнот S7avelii Airlnes', price:'550 ₽', image:'images/photo_5330078908990750485_y.avif', buyLink:'https://t.me/s7aveliishop' },
  { id: '2', title:'Комбо Блокнот + Футболка', price:'2 350 ₽', image:'images/photo_5330078908990750484_y.avif', buyLink:'https://t.me/s7aveliishop' },
  { id: '3', title:'Фирменная футболка S7avelii Airlines', price:'1 900 ₽', image:'images/photo_5332515869139530693_y.avif', buyLink:'https://t.me/s7aveliishop' },
  { id: '4', title:'Комбо Путешественник', price:'4 500 ₽', image:'images/photo_5330078908990750483_y.avif', buyLink:'https://t.me/s7aveliishop' }
];

const grid = document.getElementById('productGrid');

products.forEach(p=>{
  const card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `
    <div class="thumb"><img src="${p.image}" alt="${p.title}"></div>
    <div class="title">${p.title}</div>
    <div class="price">${p.price}</div>
    <button class="btn btn-buy" onclick="buyProduct('${p.buyLink}')">Купить</button>
    <button class="btn btn-cart" onclick="addToCart('${p.id}','${p.title}','${p.price}','${p.image}')">В корзину</button>
  `;
  grid.appendChild(card);
});

// Купить → ссылка
function buyProduct(link){
  window.open(link,'_blank');
}

// В корзину
async function addToCart(id,title,price,image){
  try {
    const res = await fetch('/api/cart/add',{
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      credentials:'include',
      body: JSON.stringify({ id, title, price, image, qty:1 })
    });
    if(res.ok){
      alert('Товар добавлен в корзину!');
    } else {
      const data = await res.json();
      if(res.status===401){
        alert('Сначала нужно войти или зарегистрироваться');
        window.location.href='/auth.html';
      } else alert(data.error || 'Ошибка добавления в корзину');
    }
  } catch(e){
    alert('Ошибка сети');
  }
}
</script>

</body>
</html>
